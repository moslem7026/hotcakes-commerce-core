/*
@license textAngular
Author : Austin Anderson
License : 2013 MIT
Version 1.5.0
See README.md or https://github.com/fraywing/textAngular/wiki for requirements and use.
*/
"undefined"!=typeof module&&"undefined"!=typeof exports&&module.exports===exports&&(module.exports="textAngular"),function(n){"use strict";var t={ie:function(){for(var i,n=3,t=document.createElement("div"),r=t.getElementsByTagName("i");t.innerHTML="<!--[if gt IE "+ ++n+"]><i><\/i><![endif]-->",r[0];);return n>4?n:i}(),webkit:/AppleWebKit\/([\d.]+)/i.test(navigator.userAgent)},s=!1,r,c,l,a,v,y,f,u,o,e;t.webkit&&(document.addEventListener("mousedown",function(n){var u=n||window.event,i=u.target,r,t;if(s&&i!==null){for(r=!1,t=i;t!==null&&t.tagName.toLowerCase()!=="html"&&!r;)r=t.contentEditable==="true",t=t.parentNode;r||(document.getElementById("textAngular-editableFix-010203040506070809").setSelectionRange(0,0),i.focus(),i.select&&i.select())}s=!1},!1),n.element(document).ready(function(){n.element(document.body).append(n.element('<input id="textAngular-editableFix-010203040506070809" class="ta-hidden-input" aria-hidden="true" unselectable="on" tabIndex="-1">'))}));var i=/^(address|article|aside|audio|blockquote|canvas|dd|div|dl|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hgroup|hr|noscript|ol|output|p|pre|section|table|tfoot|ul|video)$/i,p=/^(ul|li|ol)$/i,h=/^(address|article|aside|audio|blockquote|canvas|dd|div|dl|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hgroup|hr|noscript|ol|output|p|pre|section|table|tfoot|ul|video|li)$/i;if(String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),t.ie>8||t.ie===undefined){for(f=document.styleSheets,u=0;u<f.length;u++)if((f[u].media.length===0||f[u].media.mediaText.match(/(all|screen)/ig))&&f[u].href&&f[u].href.match(/textangular\.(min\.|)css/ig)){r=f[u];break}r||(r=function(){var n=document.createElement("style");return t.webkit&&n.appendChild(document.createTextNode("")),document.getElementsByTagName("head")[0].appendChild(n),n.sheet}());c=function(n,t){return a(r,n,t)};a=function(n,t,i){var u,f;return n.cssRules?u=Math.max(n.cssRules.length-1,0):n.rules&&(u=Math.max(n.rules.length-1,0)),n.insertRule?n.insertRule(t+"{"+i+"}",u):n.addRule(t,i,u),r.rules?f=r.rules[u]:r.cssRules&&(f=r.cssRules[u]),f};y=function(n,t){for(var r,i=0;i<t.length;i++)if(t[i].cssText===n.cssText){r=i;break}return r};l=function(n){v(r,n)};v=function(n,t){var i=n.cssRules||n.rules,r;i&&i.length!==0&&(r=y(t,i),n.removeRule?n.removeRule(r):n.deleteRule(r))}}n.module("textAngular.factories",[]).factory("taBrowserTag",[function(){return function(n){return n?n===""?t.ie===undefined?"div":t.ie<=8?"P":"p":t.ie<=8?n.toUpperCase():n:t.ie<=8?"P":"p"}}]).factory("taApplyCustomRenderers",["taCustomRenderers","taDOM",function(t,i){return function(r){var u=n.element("<div><\/div>");return u[0].innerHTML=r,n.forEach(t,function(t){var r=[];t.selector&&t.selector!==""?r=u.find(t.selector):t.customAttribute&&t.customAttribute!==""&&(r=i.getByAttribute(u,t.customAttribute));n.forEach(r,function(i){i=n.element(i);t.selector&&t.selector!==""&&t.customAttribute&&t.customAttribute!==""?i.attr(t.customAttribute)!==undefined&&t.renderLogic(i):t.renderLogic(i)})}),u[0].innerHTML}}]).factory("taFixChrome",function(){return function(t){if(!t||!n.isString(t)||t.length<=0)return t;for(var o=/<([^>\/]+?)style=("([^"]+)"|'([^']+)')([^>]*)>/ig,i,r,u,e="",f=0;i=o.exec(t);)r=i[3]||i[4],r&&r.match(/line-height: 1.[0-9]{3,12};|color: inherit; line-height: 1.1;/i)&&(r=r.replace(/( |)font-family: inherit;|( |)line-height: 1.[0-9]{3,12};|( |)color: inherit;/ig,""),u="<"+i[1].trim(),r.trim().length>0&&(u+=" style="+i[2].substring(0,1)+r+i[2].substring(0,1)),u+=i[5].trim()+">",e+=t.substring(f,i.index)+u,f=i.index+i[0].length);return e+=t.substring(f),f>0?e.replace(/<span\s?>(.*?)<\/span>(<br(\/|)>|)/ig,"$1"):t}}).factory("taSanitize",["$sanitize",function(t){function s(t,i){for(var r=0,u=0,f,e=/<[^>]*>/ig;f=e.exec(t);)if(u=f.index,f[0].substr(1,1)==="/")if(r===0)break;else r--;else r++;return i+t.substring(0,u)+n.element(i)[0].outerHTML.substring(i.length)+t.substring(u)}function h(t){var p,w;if(!t||!n.isString(t)||t.length<=0)return t;for(var f,b=/<([^>\/]+?)style=("([^"]+)"|'([^']+)')([^>]*)>/ig,r,y,u,a,o="",v,c="",l=0;r=b.exec(t);)if(u=r[3]||r[4],p=new RegExp(e,"i"),n.isString(u)&&p.test(u)){for(a="",w=new RegExp(e,"ig");y=w.exec(u);)for(f=0;f<i.length;f++)!y[f*2+2]||(a+="<"+i[f].tag+">");v=h(t.substring(l,r.index));c+=o.length>0?s(v,o):v;u=u.replace(new RegExp(e,"ig"),"");c+="<"+r[1].trim();u.length>0&&(c+=' style="'+u+'"');c+=r[5]+">";l=r.index+r[0].length;o=a}return c+(o.length>0?s(t.substring(l),o):t.substring(l))}function c(t){var r;if(!t||!n.isString(t)||t.length<=0)return t;for(var e=/<([^>\/]+?)align=("([^"]+)"|'([^']+)')([^>]*)>/ig,i,u="",f=0;i=e.exec(t);)u+=t.substring(f,i.index),f=i.index+i[0].length,r="<"+i[1]+i[5],/style=("([^"]+)"|'([^']+)')/ig.test(r)?r=r.replace(/style=("([^"]+)"|'([^']+)')/i,'style="$2$3 text-align:'+(i[3]||i[4])+';"'):r+=' style="text-align:'+(i[3]||i[4])+';"',r+=">",u+=r;return u+t.substring(f)}for(var u,f,e,i=[{property:"font-weight",values:["bold"],tag:"b"},{property:"font-style",values:["italic"],tag:"i"}],o=[],r=0;r<i.length;r++){for(u="("+i[r].property+":\\s*(",f=0;f<i[r].values.length;f++)f>0&&(u+="|"),u+=i[r].values[f];u+=");)";o.push(u)}return e="("+o.join("|")+")",function(n,i,r){var u;if(!r)try{n=h(n)}catch(v){}n=c(n);try{u=t(n);r&&(u=n)}catch(v){u=i||""}var l=u.match(/(<pre[^>]*>.*?<\/pre[^>]*>)/ig),e=u.replace(/(&#(9|10);)*/ig,""),a=/<pre[^>]*>.*?<\/pre[^>]*>/ig,o=0,s=0,f;for(u="";(f=a.exec(e))!==null&&o<l.length;)u+=e.substring(s,f.index)+l[o],s=f.index+f[0].length,o++;return u+e.substring(s)}}]).factory("taToolExecuteAction",["$q","$log",function(n,t){return function(i){i!==undefined&&(this.$editor=function(){return i});var r=n.defer(),e=r.promise,u=this.$editor(),f;try{f=this.action(r,u.startAction());e["finally"](function(){u.endAction.call(u)})}catch(o){t.error(o)}(f||f===undefined)&&r.resolve()}}]);n.module("textAngular.DOM",["textAngular.factories"]).factory("taExecCommand",["taSelection","taBrowserTag","$document",function(t,r,u){var f=function(i,r){for(var f,e=i.find("li"),u=e.length-1;u>=0;u--)f=n.element("<"+r+">"+e[u].innerHTML+"<\/"+r+">"),i.after(f);i.remove();t.setSelectionToElementEnd(f[0])},o=function(i){/(<br(|\/)>)$/i.test(i.innerHTML.trim())?t.setSelectionBeforeElement(n.element(i).find("br")[0]):t.setSelectionToElementEnd(i)},e=function(t,i){var r=n.element("<"+i+">"+t[0].innerHTML+"<\/"+i+">");t.after(r);t.remove();o(r.find("li")[0])},s=function(t,i,u){for(var e,s="",f=0;f<t.length;f++)s+="<"+r("li")+">"+t[f].innerHTML+"<\/"+r("li")+">";e=n.element("<"+u+">"+s+"<\/"+u+">");i.after(e);i.remove();o(e.find("li")[0])};return function(o,h){return o=r(o),function(c,l,a,v){var y,b,nt,w,ct,tt,it,rt=n.element("<"+o+">"),k,g,d,ht,ot,et,st,ut,ft,vt;try{it=t.getSelectionElement()}catch(pt){}if(k=n.element(it),it!==undefined)if(g=it.tagName.toLowerCase(),c.toLowerCase()==="insertorderedlist"||c.toLowerCase()==="insertunorderedlist"){if(d=r(c.toLowerCase()==="insertorderedlist"?"ol":"ul"),g===d)return f(k,o);if(g==="li"&&k.parent()[0].tagName.toLowerCase()===d&&k.parent().children().length===1)return f(k.parent(),o);if(g==="li"&&k.parent()[0].tagName.toLowerCase()!==d&&k.parent().children().length===1)return e(k.parent(),d);if(g.match(i)&&!k.hasClass("ta-bind"))return g==="ol"||g==="ul"?e(k,d):(ht=!1,n.forEach(k.children(),function(n){n.tagName.match(i)&&(ht=!0)}),ht?s(k.children(),k,d):s([n.element("<div>"+it.innerHTML+"<\/div>")[0]],k,d));if(g.match(i)){if(w=t.getOnlySelectedElements(),w.length===0)b=n.element("<"+d+"><li>"+it.innerHTML+"<\/li><\/"+d+">"),k.html(""),k.append(b);else{if(w.length===1&&(w[0].tagName.toLowerCase()==="ol"||w[0].tagName.toLowerCase()==="ul"))return w[0].tagName.toLowerCase()===d?f(n.element(w[0]),o):e(n.element(w[0]),d);for(nt="",ot=[],y=0;y<w.length;y++)if(w[y].nodeType!==3){if(et=n.element(w[y]),w[y].tagName.toLowerCase()==="li")continue;else nt+=w[y].tagName.toLowerCase()==="ol"||w[y].tagName.toLowerCase()==="ul"?et[0].innerHTML:w[y].tagName.toLowerCase()==="span"&&(w[y].childNodes[0].tagName.toLowerCase()==="ol"||w[y].childNodes[0].tagName.toLowerCase()==="ul")?et[0].childNodes[0].innerHTML:"<"+r("li")+">"+et[0].innerHTML+"<\/"+r("li")+">";ot.unshift(et)}b=n.element("<"+d+">"+nt+"<\/"+d+">");ot.pop().replaceWith(b);n.forEach(ot,function(n){n.remove()})}t.setSelectionToElementEnd(b[0]);return}}else{if(c.toLowerCase()==="formatblock"){for(tt=a.toLowerCase().replace(/[<>]/ig,""),tt.trim()==="default"&&(tt=o,a="<"+o+">"),b=g==="li"?k.parent():k;!b[0].tagName||!b[0].tagName.match(i)&&!b.parent().attr("contenteditable");)b=b.parent(),g=(b[0].tagName||"").toLowerCase();if(g===tt){for(w=b.children(),st=!1,y=0;y<w.length;y++)st=st||w[y].tagName.match(i);st?(b.after(w),ct=b.next(),b.remove(),b=ct):(rt.append(b[0].childNodes),b.after(rt),b.remove(),b=rt)}else if(b.parent()[0].tagName.toLowerCase()!==tt||b.parent().hasClass("ta-bind"))if(g.match(p))b.wrap(a);else{for(w=t.getOnlySelectedElements(),w.length===0&&(w=[b[0]]),y=0;y<w.length;y++)if(w[y].nodeType===3||!w[y].tagName.match(i))while(w[y].nodeType===3||!w[y].tagName||!w[y].tagName.match(i))w[y]=w[y].parentNode;if(n.element(w[0]).hasClass("ta-bind"))b=n.element(a),b[0].innerHTML=w[0].innerHTML,w[0].innerHTML=b[0].outerHTML;else if(tt==="blockquote"){for(nt="",y=0;y<w.length;y++)nt+=w[y].outerHTML;for(b=n.element(a),b[0].innerHTML=nt,w[0].parentNode.insertBefore(b[0],w[0]),y=w.length-1;y>=0;y--)w[y].parentNode&&w[y].parentNode.removeChild(w[y])}else for(y=0;y<w.length;y++)b=n.element(a),b[0].innerHTML=w[y].innerHTML,w[y].parentNode.insertBefore(b[0],w[y]),w[y].parentNode.removeChild(w[y])}else{for(ut=b.parent(),ft=ut.contents(),y=0;y<ft.length;y++)ut.parent().hasClass("ta-bind")&&ft[y].nodeType===3&&(rt=n.element("<"+o+">"),rt[0].innerHTML=ft[y].outerHTML,ft[y]=rt[0]),ut.parent()[0].insertBefore(ft[y],ut[0]);ut.remove()}t.setSelectionToElementEnd(b[0]);return}if(c.toLowerCase()==="createlink"){var lt='<a href="'+a+'" target="'+(v.a.target?v.a.target:"")+'">',at="<\/a>",yt=t.getSelection();yt.collapsed?t.insertHtml(lt+a+at,h):rangy.getSelection().getRangeAt(0).canSurroundContents()&&(vt=n.element(lt+at)[0],rangy.getSelection().getRangeAt(0).surroundContents(vt));return}if(c.toLowerCase()==="inserthtml"){t.insertHtml(a,h);return}}try{u[0].execCommand(c,l,a)}catch(pt){}}}}]).service("taSelection",["$window","$document","taDOM",function(t,r,u){var e=r[0],f=t.rangy,s=function(n,t){return n.tagName&&n.tagName.match(/^br$/i)&&t===0&&!n.previousSibling?{element:n.parentNode,offset:0}:{element:n,offset:t}},o={getSelection:function(){var t=f.getSelection().getRangeAt(0),n=t.commonAncestorContainer,i={start:s(t.startContainer,t.startOffset),end:s(t.endContainer,t.endOffset),collapsed:t.collapsed};return n=n.nodeType===3?n.parentNode:n,i.container=n.parentNode===i.start.element||n.parentNode===i.end.element?n.parentNode:n,i},getOnlySelectedElements:function(){var t=f.getSelection().getRangeAt(0),n=t.commonAncestorContainer;return n=n.nodeType===3?n.parentNode:n,t.getNodes([1],function(t){return t.parentNode===n})},getSelectionElement:function(){return o.getSelection().container},setSelection:function(n,t,i){var r=f.createRange();r.setStart(n,t);r.setEnd(n,i);f.getSelection().setSingleRange(r)},setSelectionBeforeElement:function(n){var t=f.createRange();t.selectNode(n);t.collapse(!0);f.getSelection().setSingleRange(t)},setSelectionAfterElement:function(n){var t=f.createRange();t.selectNode(n);t.collapse(!1);f.getSelection().setSingleRange(t)},setSelectionToElementStart:function(n){var t=f.createRange();t.selectNodeContents(n);t.collapse(!0);f.getSelection().setSingleRange(t)},setSelectionToElementEnd:function(n){var t=f.createRange();t.selectNodeContents(n);t.collapse(!1);n.childNodes&&n.childNodes[n.childNodes.length-1]&&n.childNodes[n.childNodes.length-1].nodeName==="br"&&(t.startOffset=t.endOffset=t.startOffset-1);f.getSelection().setSingleRange(t)},insertHtml:function(t,r){var s,l,a,d,w,v,nt,b=n.element("<div>"+t+"<\/div>"),c=f.getSelection().getRangeAt(0),y=e.createDocumentFragment(),p=b[0].childNodes,k=!0,g,tt;if(p.length>0){for(d=[],a=0;a<p.length;a++)p[a].nodeName.toLowerCase()==="p"&&p[a].innerHTML.trim()===""||p[a].nodeType===3&&p[a].nodeValue.trim()===""||(k=k&&!i.test(p[a].nodeName),d.push(p[a]));for(g=0;g<d.length;g++)v=y.appendChild(d[g]);!k&&c.collapsed&&/^(|<br(|\/)>)$/i.test(c.startContainer.innerHTML)&&c.selectNode(c.startContainer)}else k=!0,v=y=e.createTextNode(t);if(k)c.deleteContents();else if(c.collapsed&&c.startContainer!==r)if(c.startContainer.innerHTML&&c.startContainer.innerHTML.match(/^<[^>]*>$/i))s=c.startContainer,c.startOffset===1?(c.setStartAfter(s),c.setEndAfter(s)):(c.setStartBefore(s),c.setEndBefore(s));else{if(c.startContainer.nodeType===3&&c.startContainer.parentNode!==r)for(s=c.startContainer.parentNode,l=s.cloneNode(),u.splitNodes(s.childNodes,s,l,c.startContainer,c.startOffset);!h.test(s.nodeName);)n.element(s).after(l),s=s.parentNode,tt=l,l=s.cloneNode(),u.splitNodes(s.childNodes,s,l,tt);else s=c.startContainer,l=s.cloneNode(),u.splitNodes(s.childNodes,s,l,undefined,undefined,c.startOffset);if(n.element(s).after(l),c.setStartAfter(s),c.setEndAfter(s),/^(|<br(|\/)>)$/i.test(s.innerHTML.trim())&&(c.setStartBefore(s),c.setEndBefore(s),n.element(s).remove()),/^(|<br(|\/)>)$/i.test(l.innerHTML.trim())&&n.element(l).remove(),s.nodeName.toLowerCase()==="li"){for(nt=e.createDocumentFragment(),w=0;w<y.childNodes.length;w++)b=n.element("<li>"),u.transferChildNodes(y.childNodes[w],b[0]),u.transferNodeAttributes(y.childNodes[w],b[0]),nt.appendChild(b[0]);y=nt;v&&(v=y.childNodes[y.childNodes.length-1],v=v.childNodes[v.childNodes.length-1])}}else c.deleteContents();c.insertNode(y);v&&o.setSelectionToElementEnd(v)}};return o}]).service("taDOM",function(){var t={getByAttribute:function(i,r){var u=[],f=i.children();return f.length&&n.forEach(f,function(i){u=u.concat(t.getByAttribute(n.element(i),r))}),i.attr(r)!==undefined&&u.push(i),u},transferChildNodes:function(n,t){for(t.innerHTML="";n.childNodes.length>0;)t.appendChild(n.childNodes[0]);return t},splitNodes:function(n,i,r,u,f,e){if(!u&&isNaN(e))throw new Error("taDOM.splitNodes requires a splitNode or splitIndex");for(var o=document.createDocumentFragment(),s=document.createDocumentFragment(),h=0;n.length>0&&(isNaN(e)||e!==h)&&n[0]!==u;)o.appendChild(n[0]),h++;for(!isNaN(f)&&f>=0&&n[0]&&(o.appendChild(document.createTextNode(n[0].nodeValue.substring(0,f))),n[0].nodeValue=n[0].nodeValue.substring(f));n.length>0;)s.appendChild(n[0]);t.transferChildNodes(o,i);t.transferChildNodes(s,r)},transferNodeAttributes:function(n,t){for(var i=0;i<n.attributes.length;i++)t.setAttribute(n.attributes[i].name,n.attributes[i].value);return t}};return t});n.module("textAngular.validators",[]).directive("taMaxText",function(){return{restrict:"A",require:"ngModel",link:function(t,i,r,u){var f=parseInt(t.$eval(r.taMaxText));if(isNaN(f))throw"Max text must be an integer";r.$observe("taMaxText",function(n){if(f=parseInt(n),isNaN(f))throw"Max text must be an integer";u.$dirty&&u.$validate()});u.$validators.taMaxText=function(t){var i=n.element("<div/>");return i.html(t),i.text().length<=f}}}}).directive("taMinText",function(){return{restrict:"A",require:"ngModel",link:function(t,i,r,u){var f=parseInt(t.$eval(r.taMinText));if(isNaN(f))throw"Min text must be an integer";r.$observe("taMinText",function(n){if(f=parseInt(n),isNaN(f))throw"Min text must be an integer";u.$dirty&&u.$validate()});u.$validators.taMinText=function(t){var i=n.element("<div/>");return i.html(t),!i.text().length||i.text().length>=f}}}});n.module("textAngular.taBind",["textAngular.factories","textAngular.DOM"]).service("_taBlankTest",[function(){var n=/<(a|abbr|acronym|bdi|bdo|big|cite|code|del|dfn|img|ins|kbd|label|map|mark|q|ruby|rp|rt|s|samp|time|tt|var)[^>]*(>|$)/i;return function(t){return function(i){if(!i)return!0;var u=/(^[^<]|>)[^<]/i.exec(i),r;return(u?r=u.index:(i=i.toString().replace(/="[^"]*"/i,"").replace(/="[^"]*"/i,"").replace(/="[^"]*"/i,"").replace(/="[^"]*"/i,""),r=i.indexOf(">")),i=i.trim().substring(r,r+100),/^[^<>]+$/i.test(i))?!1:i.length===0||i===t||/^>(\s|&nbsp;)*<\/[^>]+>$/ig.test(i)?!0:/>\s*[^\s<]/i.test(i)||n.test(i)?!1:!0}}}]).directive("taButton",[function(){return{link:function(t,i){i.attr("unselectable","on");i.on("mousedown",function(t,i){return i&&n.extend(t,i),t.preventDefault(),!1})}}}]).directive("taBind",["taSanitize","$timeout","$window","$document","taFixChrome","taBrowserTag","taSelection","taSelectableElements","taApplyCustomRenderers","taOptions","_taBlankTest","$parse","taDOM","textAngularManager",function(r,u,f,e,a,v,y,p,w,b,k,d,g,nt){return{priority:2,require:["ngModel","?ngModelOptions"],link:function(v,tt,it,rt){function tr(n){var t;return nr.forEach(function(i){if(i.keyCode===n.keyCode){var r=(n.metaKey?ct:0)+(n.ctrlKey?ht:0)+(n.shiftKey?at:0)+(n.altKey?lt:0);if(i.forbiddenModifiers&r)return;i.mustHaveModifiers.every(function(n){return r&n})&&(t=i.specialKey)}}),t}var ut=rt[0],ii=rt[1]||{},et=tt.attr("contenteditable")!==undefined&&tt.attr("contenteditable"),vi=et||tt[0].tagName.toLowerCase()==="textarea"||tt[0].tagName.toLowerCase()==="input",ft=!1,gt=!1,ri=!1,yi=it.taUnsafeSanitizer||b.disableSanitizer,pi,di=/^(9|19|20|27|33|34|35|36|37|38|39|40|45|112|113|114|115|116|117|118|119|120|121|122|123|144|145)$/i,gi=/^(8|13|32|46|59|61|107|109|173|186|187|188|189|190|191|192|219|220|221|222)$/i,ui,ot,fi,ht=1,ct=2,lt=4,at=8,nr=[{specialKey:"UndoKey",forbiddenModifiers:lt+at,mustHaveModifiers:[ct+ht],keyCode:90},{specialKey:"RedoKey",forbiddenModifiers:lt,mustHaveModifiers:[ct+ht,at],keyCode:90},{specialKey:"RedoKey",forbiddenModifiers:lt+at,mustHaveModifiers:[ct+ht],keyCode:89},{specialKey:"TabKey",forbiddenModifiers:ct+at+lt+ht,mustHaveModifiers:[],keyCode:9},{specialKey:"ShiftTabKey",forbiddenModifiers:ct+lt+ht,mustHaveModifiers:[at],keyCode:9}],ni,ei,yt,oi,bt,hi,ci,ki;it.taDefaultWrap===undefined&&(it.taDefaultWrap="p");it.taDefaultWrap===""?(ot="",fi=t.ie===undefined?"<div><br><\/div>":t.ie>=11?"<p><br><\/p>":t.ie<=8?"<P>&nbsp;<\/P>":"<p>&nbsp;<\/p>"):(ot=t.ie===undefined||t.ie>=11?"<"+it.taDefaultWrap+"><br><\/"+it.taDefaultWrap+">":t.ie<=8?"<"+it.taDefaultWrap.toUpperCase()+"><\/"+it.taDefaultWrap.toUpperCase()+">":"<"+it.taDefaultWrap+"><\/"+it.taDefaultWrap+">",fi=t.ie===undefined||t.ie>=11?"<"+it.taDefaultWrap+"><br><\/"+it.taDefaultWrap+">":t.ie<=8?"<"+it.taDefaultWrap.toUpperCase()+">&nbsp;<\/"+it.taDefaultWrap.toUpperCase()+">":"<"+it.taDefaultWrap+">&nbsp;<\/"+it.taDefaultWrap+">");ii.$options||(ii.$options={});ni=k(fi);ei=function(t){var h,f,r,c,u,e,o,s;if(ni(t))return t;if(h=n.element("<div>"+t+"<\/div>"),h.children().length===0)t="<"+it.taDefaultWrap+">"+t+"<\/"+it.taDefaultWrap+">";else{for(f=h[0].childNodes,c=!1,r=0;r<f.length;r++)if(c=f[r].nodeName.toLowerCase().match(i))break;if(c)for(t="",r=0;r<f.length;r++)u=f[r],e=u.nodeName.toLowerCase(),e==="#comment"?t+="<!--"+u.nodeValue+"-->":e==="#text"?(o=u.textContent,t+=o.trim()?"<"+it.taDefaultWrap+">"+o+"<\/"+it.taDefaultWrap+">":o):e.match(i)?t+=u.outerHTML:(s=u.outerHTML||u.nodeValue,t+=s.trim()!==""?"<"+it.taDefaultWrap+">"+s+"<\/"+it.taDefaultWrap+">":s);else t="<"+it.taDefaultWrap+">"+t+"<\/"+it.taDefaultWrap+">"}return t};it.taPaste&&(ui=d(it.taPaste));tt.addClass("ta-bind");v["$undoManager"+(it.id||"")]=ut.$undoManager={_stack:[],_index:0,_max:1e3,push:function(n){return typeof n=="undefined"||n===null||typeof this.current()!="undefined"&&this.current()!==null&&n===this.current()?n:(this._index<this._stack.length-1&&(this._stack=this._stack.slice(0,this._index+1)),this._stack.push(n),yt&&u.cancel(yt),this._stack.length>this._max&&this._stack.shift(),this._index=this._stack.length-1,n)},undo:function(){return this.setToIndex(this._index-1)},redo:function(){return this.setToIndex(this._index+1)},setToIndex:function(n){return n<0||n>this._stack.length-1?undefined:(this._index=n,this.current())},current:function(){return this._stack[this._index]}};var vt,ir=v["$undoTaBind"+(it.id||"")]=function(){if(!ft&&et){var n=ut.$undoManager.undo();typeof n!="undefined"&&n!==null&&(st(n),wt(n,!1),vt&&u.cancel(vt),vt=u(function(){tt[0].focus();y.setSelectionToElementEnd(tt[0])},1))}},rr=v["$redoTaBind"+(it.id||"")]=function(){if(!ft&&et){var n=ut.$undoManager.redo();typeof n!="undefined"&&n!==null&&(st(n),wt(n,!1),vt&&u.cancel(vt),vt=u(function(){tt[0].focus();y.setSelectionToElementEnd(tt[0])},1))}},pt=function(){if(et)return tt[0].innerHTML;if(vi)return tt.val();throw"textAngular Error: attempting to update non-editable taBind";},wt=function(n,t,i){ri=i||!1;(typeof t=="undefined"||t===null)&&(t=!0&&et);(typeof n=="undefined"||n===null)&&(n=pt());ni(n)?(ut.$viewValue!==""&&ut.$setViewValue(""),t&&ut.$undoManager.current()!==""&&ut.$undoManager.push("")):(li(),ut.$viewValue!==n&&(ut.$setViewValue(n),t&&ut.$undoManager.push(n)));ut.$render()};if(v["updateTaBind"+(it.id||"")]=function(){ft||wt(undefined,undefined,!0)},oi=function(n){return ut.$oldViewValue=r(a(n),ut.$oldViewValue,yi)},tt.attr("required")&&(ut.$validators.required=function(n,t){return!ni(n||t)}),ut.$parsers.push(oi),ut.$parsers.unshift(ei),ut.$formatters.push(oi),ut.$formatters.unshift(ei),ut.$formatters.unshift(function(n){return ut.$undoManager.push(n||"")}),vi)if(v.events={},et){bt=!1;hi=function(t){var o,nt,s,e,f,l,ft,it,k,p,d,rt;if(t&&t.trim().length){if(t.match(/class=["']*Mso(Normal|List)/i)||t.match(/content=["']*Word.Document/i)){o=t.match(/<!--StartFragment-->([\s\S]*?)<!--EndFragment-->/i);o=o?o[1]:t;o=o.replace(/<o:p>[\s\S]*?<\/o:p>/ig,"").replace(/class=(["']|)MsoNormal(["']|)/ig,"");var w=n.element("<div>"+o+"<\/div>"),c=n.element("<div><\/div>"),i={element:null,lastIndent:[],lastLi:null,isUl:!1};for(i.lastIndent.peek=function(){var n=this.length;if(n>0)return this[n-1]},nt=function(t){i.isUl=t;i.element=n.element(t?"<ul>":"<ol>");i.lastIndent=[];i.lastIndent.peek=function(){var n=this.length;if(n>0)return this[n-1]};i.lastLevelMatch=null},s=0;s<=w[0].childNodes.length;s++){if(w[0].childNodes[s]&&w[0].childNodes[s].nodeName!=="#text"){if(e=w[0].childNodes[s].tagName.toLowerCase(),e!=="p"&&e!=="h1"&&e!=="h2"&&e!=="h3"&&e!=="h4"&&e!=="h5"&&e!=="h6")continue}else continue;if(f=n.element(w[0].childNodes[s]),l=(f.attr("class")||"").match(/MsoList(Bullet|Number|Paragraph)(CxSp(First|Middle|Last)|)/i),l){if(f[0].childNodes.length<2||f[0].childNodes[1].childNodes.length<1)continue;var b=l[1].toLowerCase()==="bullet"||l[1].toLowerCase()!=="number"&&!(/^[^0-9a-z<]*[0-9a-z]+[^0-9a-z<>]</i.test(f[0].childNodes[1].innerHTML)||/^[^0-9a-z<]*[0-9a-z]+[^0-9a-z<>]</i.test(f[0].childNodes[1].childNodes[0].innerHTML)),et=(f.attr("style")||"").match(/margin-left:([\-\.0-9]*)/i),h=parseFloat(et?et[1]:0),a=(f.attr("style")||"").match(/mso-list:l([0-9]+) level([0-9]+) lfo[0-9+]($|;)/i);if(a&&a[2]&&(h=parseInt(a[2])),(!a||i.lastLevelMatch&&a[1]===i.lastLevelMatch[1])&&l[3]&&l[3].toLowerCase()!=="first"&&i.lastIndent.peek()!==null&&(i.isUl===b||i.lastIndent.peek()!==h)){if(i.lastIndent.peek()!=null&&i.lastIndent.peek()<h)i.element=n.element(b?"<ul>":"<ol>"),i.lastLi.append(i.element);else if(i.lastIndent.peek()!=null&&i.lastIndent.peek()>h){while(i.lastIndent.peek()!=null&&i.lastIndent.peek()>h){if(i.element.parent()[0].tagName.toLowerCase()==="li"){i.element=i.element.parent();continue}else if(/[uo]l/i.test(i.element.parent()[0].tagName.toLowerCase()))i.element=i.element.parent();else break;i.lastIndent.pop()}i.isUl=i.element[0].tagName.toLowerCase()==="ul";b!==i.isUl&&(nt(b),c.append(i.element))}}else nt(b),c.append(i.element);i.lastLevelMatch=a;h!==i.lastIndent.peek()&&i.lastIndent.push(h);i.lastLi=n.element("<li>");i.element.append(i.lastLi);i.lastLi.html(f.html().replace(/<!(--|)\[if !supportLists\](--|)>[\s\S]*?<!(--|)\[endif\](--|)>/ig,""));f.remove()}else nt(!1),c.append(f)}ft=function(t){t=n.element(t);for(var i=t[0].childNodes.length-1;i>=0;i--)t.after(t[0].childNodes[i]);t.remove()};n.forEach(c.find("span"),function(n){n.removeAttribute("lang");n.attributes.length<=0&&ft(n)});n.forEach(c.find("font"),ft);t=c.html()}else{if(t=t.replace(/<(|\/)meta[^>]*?>/ig,""),t.match(/<[^>]*?(ta-bind)[^>]*?>/)){if(t.match(/<[^>]*?(text-angular)[^>]*?>/)){for(it=n.element("<div>"+t+"<\/div>"),it.find("textarea").remove(),k=g.getByAttribute(it,"ta-bind"),p=0;p<k.length;p++){for(d=k[p][0].parentNode.parentNode,rt=0;rt<k[p][0].childNodes.length;rt++)d.parentNode.insertBefore(k[p][0].childNodes[rt],d);d.parentNode.removeChild(d)}t=it.html().replace('<br class="Apple-interchange-newline">',"")}}else t.match(/^<span/)&&(t.match(/<span class=(\"Apple-converted-space\"|\'Apple-converted-space\')>.<\/span>/ig)||(t=t.replace(/<(|\/)span[^>]*?>/ig,"")));t=t.replace(/<br class="Apple-interchange-newline"[^>]*?>/ig,"").replace(/<span class="Apple-converted-space">( |&nbsp;)<\/span>/ig,"&nbsp;")}/<li(\s.*)?>/i.test(t)&&/(<ul(\s.*)?>|<ol(\s.*)?>).*<li(\s.*)?>/i.test(t)===!1&&(t=t.replace(/<li(\s.*)?>.*<\/li(\s.*)?>/i,"<ul>$&<\/ul>"));t=t.replace(/^[ |\u00A0]+/gm,function(n){for(var t="",i=0;i<n.length;i++)t+="&nbsp;";return t}).replace(/\n|\r\n|\r/g,"<br />").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;");ui&&(t=ui(v,{$html:t})||t);t=r(t,"",yi);y.insertHtml(t,tt[0]);u(function(){ut.$setViewValue(pt());bt=!1;tt.removeClass("processing-paste")},0)}else bt=!1,tt.removeClass("processing-paste")};tt.on("paste",v.events.paste=function(t,i){var c,r,s,h,l,o;if(i&&n.extend(t,i),ft||bt)return t.stopPropagation(),t.preventDefault(),!1;if(bt=!0,tt.addClass("processing-paste"),r=(t.originalEvent||t).clipboardData,r&&r.getData&&r.types.length>0){for(s="",h=0;h<r.types.length;h++)s+=" "+r.types[h];return/text\/html/i.test(s)?c=r.getData("text/html"):/text\/plain/i.test(s)&&(c=r.getData("text/plain")),hi(c),t.stopPropagation(),t.preventDefault(),!1}l=f.rangy.saveSelection();o=n.element('<div class="ta-hidden-input" contenteditable="true"><\/div>');e.find("body").append(o);o[0].focus();u(function(){f.rangy.restoreSelection(l);hi(o[0].innerHTML);tt[0].focus();o.remove()},0)});tt.on("cut",v.events.cut=function(n){ft?n.preventDefault():u(function(){ut.$setViewValue(pt())},0)});tt.on("keydown",v.events.keydown=function(t,i){var o,s,u,r,f,c,e;if(i&&n.extend(t,i),t.specialKey=tr(t),b.keyMappings.forEach(function(n){t.specialKey===n.commandKeyCode&&(t.specialKey=undefined);n.testForKey(t)&&(o=n.commandKeyCode);(n.commandKeyCode==="UndoKey"||n.commandKeyCode==="RedoKey")&&(n.enablePropagation||t.preventDefault())}),typeof o!="undefined"&&(t.specialKey=o),typeof t.specialKey!="undefined"&&(t.specialKey!=="UndoKey"||t.specialKey!=="RedoKey")&&(t.preventDefault(),nt.sendKeyCommand(v,t)),!ft&&(t.specialKey==="UndoKey"&&(ir(),t.preventDefault()),t.specialKey==="RedoKey"&&(rr(),t.preventDefault()),t.keyCode===13&&!t.shiftKey)){if(s=function(n,t){for(var i=0;i<n.length;i++)if(n[i]===t)return!0;return!1},r=y.getSelectionElement(),!r.tagName.match(h))return;f=n.element(ot);c=["blockquote","ul","ol"];s(c,r.parentNode.tagName.toLowerCase())&&(/^<br(|\/)>$/i.test(r.innerHTML.trim())&&!r.nextSibling&&(u=n.element(r),e=u.parent(),e.after(f),u.remove(),e.children().length===0&&e.remove(),y.setSelectionToElementStart(f[0]),t.preventDefault()),/^<[^>]+><br(|\/)><\/[^>]+>$/i.test(r.innerHTML.trim())&&(u=n.element(r),u.after(f),u.remove(),y.setSelectionToElementStart(f[0]),t.preventDefault()))}});tt.on("keyup",v.events.keyup=function(t,i){var s,r,e,f,o;if(i&&n.extend(t,i),t.keyCode===9){s=y.getSelection();s.start.element===tt[0]&&tt.children().length&&y.setSelectionToElementStart(tt.children()[0]);return}if(yt&&u.cancel(yt),!ft&&!di.test(t.keyCode)){if(ot!==""&&t.keyCode===13&&!t.shiftKey){for(r=y.getSelectionElement();!r.tagName.match(h)&&r!==tt[0];)r=r.parentNode;r.tagName.toLowerCase()!==it.taDefaultWrap&&r.tagName.toLowerCase()!=="li"&&(r.innerHTML.trim()===""||r.innerHTML.trim()==="<br>")&&(e=n.element(ot),n.element(r).replaceWith(e),y.setSelectionToElementStart(e[0]))}f=pt();ot!==""&&f.trim()===""?(st(ot),y.setSelectionToElementStart(tt.children()[0])):f.substring(0,1)!=="<"&&it.taDefaultWrap!=="";o=pi!==t.keyCode&&gi.test(t.keyCode);ci&&u.cancel(ci);ci=u(function(){wt(f,o,!0);v.html=f},ii.$options.debounce||400);o||(yt=u(function(){ut.$undoManager.push(f)},250));pi=t.keyCode}});if(it.placeholder&&(t.ie>8||t.ie===undefined)){if(it.id)ki=c("#"+it.id+".placeholder-text:before",'content: "'+it.placeholder+'"');else throw"textAngular Error: An unique ID is required for placeholders to work";v.$on("$destroy",function(){l(ki)})}tt.on("focus",v.events.focus=function(){gt=!0;tt.removeClass("placeholder-text");li()});tt.on("mouseup",v.events.mouseup=function(){var n=y.getSelection();n.start.element===tt[0]&&tt.children().length&&y.setSelectionToElementStart(tt.children()[0])});tt.on("mousedown",v.events.mousedown=function(t,i){i&&n.extend(t,i);t.stopPropagation()})}else{tt.on("change blur",v.events.change=v.events.blur=function(){ft||ut.$setViewValue(pt())});tt.on("keydown",v.events.keydown=function(t,i){var e,f;if(i&&n.extend(t,i),t.keyCode===9){var u=this.selectionStart,o=this.selectionEnd,r=tt.val();t.shiftKey?(e=r.lastIndexOf("\n",u),f=r.lastIndexOf("\t",u),f!==-1&&f>=e&&(tt.val(r.substring(0,f)+r.substring(f+1)),this.selectionStart=this.selectionEnd=u-1)):(tt.val(r.substring(0,u)+"\t"+r.substring(o)),this.selectionStart=this.selectionEnd=u+1);t.preventDefault()}});var si=function(n,t){for(var i="",r=0;r<t;r++)i+=n;return i},wi=function(n,t,i){for(var r=0;r<n.length;r++)t.call(i,r,n[r])},bi=function(n,t){var i="",r=n.childNodes;return t++,i+=si("\t",t-1)+n.outerHTML.substring(0,4),wi(r,function(n,r){var u=r.nodeName.toLowerCase();if(u==="#comment"){i+="<!--"+r.nodeValue+"-->";return}if(u==="#text"){i+=r.textContent;return}r.outerHTML&&(i+=u==="ul"||u==="ol"?"\n"+bi(r,t):"\n"+si("\t",t)+r.outerHTML)}),i+="\n"+si("\t",t-1)+n.outerHTML.substring(n.outerHTML.lastIndexOf("<"))};ut.$formatters.unshift(function(t){var i=n.element("<div>"+t+"<\/div>")[0].childNodes;return i.length>0&&(t="",wi(i,function(n,i){var r=i.nodeName.toLowerCase();if(r==="#comment"){t+="<!--"+i.nodeValue+"-->";return}if(r==="#text"){t+=i.textContent;return}i.outerHTML&&(t.length>0&&(t+="\n"),t+=r==="ul"||r==="ol"?""+bi(i,0):""+i.outerHTML)})),t})}var kt=function(n){return v.$emit("ta-element-select",this),n.preventDefault(),!1},dt=function(t,i){if(i&&n.extend(t,i),!o&&!ft){o=!0;var r;r=t.originalEvent?t.originalEvent.dataTransfer:t.dataTransfer;v.$emit("ta-drop-event",this,t,r);u(function(){o=!1;wt(undefined,undefined,!0)},100)}},li=v["reApplyOnSelectorHandlers"+(it.id||"")]=function(){ft||n.forEach(p,function(n){tt.find(n).off("click",kt).on("click",kt)})},st=function(n){tt[0].innerHTML=n},ti,ai=!1;if(ut.$render=function(){if(!ai){ai=!0;var n=ut.$viewValue||"";if(!ri)if(et&&gt&&(tt.removeClass("placeholder-text"),ti&&u.cancel(ti),ti=u(function(){gt||(tt[0].focus(),y.setSelectionToElementEnd(tt.children()[tt.children().length-1]));ti=undefined},1)),et)if(it.placeholder?n===""?st(ot):st(n):st(n===""?ot:n),ft)tt.off("drop",dt);else{li();tt.on("drop",dt)}else tt[0].tagName.toLowerCase()!=="textarea"&&tt[0].tagName.toLowerCase()!=="input"?st(w(n)):tt.val(n);et&&it.placeholder&&(n===""?gt?tt.removeClass("placeholder-text"):tt.addClass("placeholder-text"):tt.removeClass("placeholder-text"));ai=ri=!1}},it.taReadonly&&(ft=v.$eval(it.taReadonly),ft?(tt.addClass("ta-readonly"),(tt[0].tagName.toLowerCase()==="textarea"||tt[0].tagName.toLowerCase()==="input")&&tt.attr("disabled","disabled"),tt.attr("contenteditable")!==undefined&&tt.attr("contenteditable")&&tt.removeAttr("contenteditable")):(tt.removeClass("ta-readonly"),tt[0].tagName.toLowerCase()==="textarea"||tt[0].tagName.toLowerCase()==="input"?tt.removeAttr("disabled"):et&&tt.attr("contenteditable","true")),v.$watch(it.taReadonly,function(t,i){if(i!==t){if(t)tt.addClass("ta-readonly"),(tt[0].tagName.toLowerCase()==="textarea"||tt[0].tagName.toLowerCase()==="input")&&tt.attr("disabled","disabled"),tt.attr("contenteditable")!==undefined&&tt.attr("contenteditable")&&tt.removeAttr("contenteditable"),n.forEach(p,function(n){tt.find(n).on("click",kt)}),tt.off("drop",dt);else{tt.removeClass("ta-readonly");tt[0].tagName.toLowerCase()==="textarea"||tt[0].tagName.toLowerCase()==="input"?tt.removeAttr("disabled"):et&&tt.attr("contenteditable","true");n.forEach(p,function(n){tt.find(n).off("click",kt)});tt.on("drop",dt)}ft=t}})),et&&!ft){n.forEach(p,function(n){tt.find(n).on("click",kt)});tt.on("drop",dt);tt.on("blur",function(){t.webkit&&(s=!0)})}}}}]);o=!1;e=n.module("textAngular",["ngSanitize","textAngularSetup","textAngular.factories","textAngular.DOM","textAngular.validators","textAngular.taBind"]);e.config([function(){n.forEach(taTools,function(n,t){delete taTools[t]})}]);e.run([function(){if(typeof define=="function"&&define.amd)define(function(n){window.rangy=n("rangy");window.rangy.saveSelection=n("rangy/lib/rangy-selectionsaverestore")});else if(typeof require=="function"&&typeof module!="undefined"&&typeof exports=="object")window.rangy=require("rangy"),window.rangy.saveSelection=require("rangy/lib/rangy-selectionsaverestore");else if(window.rangy){if(window.rangy.init(),!window.rangy.saveSelection)throw"rangy-selectionsaverestore.js is required for textAngular to work correctly.";}else throw"rangy-core.js and rangy-selectionsaverestore.js are required for textAngular to work correctly, rangy-core is not yet loaded.";}]);e.directive("textAngular",["$compile","$timeout","taOptions","taSelection","taExecCommand","textAngularManager","$window","$document","$animate","$log","$q","$parse",function(t,i,r,u,f,e,o,s,h,c,l,a){return{require:"?ngModel",scope:{},restrict:"EA",priority:2,link:function(v,y,p,w){var it,rt,ut,ft,et,ot,nt,d,b=p.serial?p.serial:Math.floor(Math.random()*10000000000000000),lt,st,ht,tt,g,ct,k;if(v._name=p.name?p.name:"textAngularEditor"+b,tt=function(n,t,r){i(function(){var i=function(){n.off(t,i);r.apply(this,arguments)};n.on(t,i)},100)},lt=f(p.taDefaultWrap),n.extend(v,n.copy(r),{wrapSelection:function(n,t,i){n.toLowerCase()==="undo"?v["$undoTaBindtaTextElement"+b]():n.toLowerCase()==="redo"?v["$redoTaBindtaTextElement"+b]():(lt(n,!1,t,v.defaultTagAttributes),i&&v["reApplyOnSelectorHandlerstaTextElement"+b](),v.displayElements.text[0].focus())},showHtml:v.$eval(p.taShowHtml)||!1}),p.taFocussedClass&&(v.classes.focussed=p.taFocussedClass),p.taTextEditorClass&&(v.classes.textEditor=p.taTextEditorClass),p.taHtmlEditorClass&&(v.classes.htmlEditor=p.taHtmlEditorClass),p.taDefaultTagAttributes)try{n.extend(v.defaultTagAttributes,n.fromJson(p.taDefaultTagAttributes))}catch(at){c.error(at)}p.taTextEditorSetup&&(v.setup.textEditorSetup=v.$parent.$eval(p.taTextEditorSetup));p.taHtmlEditorSetup&&(v.setup.htmlEditorSetup=v.$parent.$eval(p.taHtmlEditorSetup));v.fileDropHandler=p.taFileDrop?v.$parent.$eval(p.taFileDrop):v.defaultFileDropHandler;nt=y[0].innerHTML;y[0].innerHTML="";v.displayElements={forminput:n.element("<input type='hidden' tabindex='-1' style='display: none;'>"),html:n.element("<textarea><\/textarea>"),text:n.element("<div><\/div>"),scrollWindow:n.element("<div class='ta-scroll-window'><\/div>"),popover:n.element('<div class="popover fade bottom" style="max-width: none; width: 305px;"><\/div>'),popoverArrow:n.element('<div class="arrow"><\/div>'),popoverContainer:n.element('<div class="popover-content"><\/div>'),resize:{overlay:n.element('<div class="ta-resizer-handle-overlay"><\/div>'),background:n.element('<div class="ta-resizer-handle-background"><\/div>'),anchors:[n.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-tl"><\/div>'),n.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-tr"><\/div>'),n.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-bl"><\/div>'),n.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-br"><\/div>')],info:n.element('<div class="ta-resizer-handle-info"><\/div>')}};v.displayElements.popover.append(v.displayElements.popoverArrow);v.displayElements.popover.append(v.displayElements.popoverContainer);v.displayElements.scrollWindow.append(v.displayElements.popover);v.displayElements.popover.on("mousedown",function(t,i){return i&&n.extend(t,i),t.preventDefault(),!1});v.showPopover=function(n){v.displayElements.popover.css("display","block");v.reflowPopover(n);h.addClass(v.displayElements.popover,"in");tt(s.find("body"),"click keyup",function(){v.hidePopover()})};v.reflowPopover=function(n){v.displayElements.text[0].offsetHeight-51>n[0].offsetTop?(v.displayElements.popover.css("top",n[0].offsetTop+n[0].offsetHeight+v.displayElements.scrollWindow[0].scrollTop+"px"),v.displayElements.popover.removeClass("top").addClass("bottom")):(v.displayElements.popover.css("top",n[0].offsetTop-54+v.displayElements.scrollWindow[0].scrollTop+"px"),v.displayElements.popover.removeClass("bottom").addClass("top"));var i=v.displayElements.text[0].offsetWidth-v.displayElements.popover[0].offsetWidth,t=n[0].offsetLeft+n[0].offsetWidth/2-v.displayElements.popover[0].offsetWidth/2;v.displayElements.popover.css("left",Math.max(0,Math.min(i,t))+"px");v.displayElements.popoverArrow.css("margin-left",Math.min(t,Math.max(0,t-i))-11+"px")};v.hidePopover=function(){v.displayElements.popover.css("display","");v.displayElements.popoverContainer.attr("style","");v.displayElements.popoverContainer.attr("class","popover-content");v.displayElements.popover.removeClass("in")};v.displayElements.resize.overlay.append(v.displayElements.resize.background);n.forEach(v.displayElements.resize.anchors,function(n){v.displayElements.resize.overlay.append(n)});v.displayElements.resize.overlay.append(v.displayElements.resize.info);v.displayElements.scrollWindow.append(v.displayElements.resize.overlay);v.reflowResizeOverlay=function(t){t=n.element(t)[0];v.displayElements.resize.overlay.css({display:"block",left:t.offsetLeft-5+"px",top:t.offsetTop-5+"px",width:t.offsetWidth+10+"px",height:t.offsetHeight+10+"px"});v.displayElements.resize.info.text(t.offsetWidth+" x "+t.offsetHeight)};v.showResizeOverlay=function(t){var i=s.find("body");st=function(r){var u={width:parseInt(t.attr("width")),height:parseInt(t.attr("height")),x:r.clientX,y:r.clientY},f,e;(u.width===undefined||isNaN(u.width))&&(u.width=t[0].offsetWidth);(u.height===undefined||isNaN(u.height))&&(u.height=t[0].offsetHeight);v.hidePopover();f=u.height/u.width;e=function(i){function s(n){return Math.round(Math.max(0,n))}var r={x:Math.max(0,u.width+(i.clientX-u.x)),y:Math.max(0,u.height+(i.clientY-u.y))},h=p.taResizeForceAspectRatio!==undefined,c=p.taResizeMaintainAspectRatio,l=h||c&&!i.shiftKey,e,o;l&&(e=r.y/r.x,r.x=f>e?r.x:r.y/f,r.y=f>e?r.x*f:r.y);o=n.element(t);o.css("height",s(r.y)+"px");o.css("width",s(r.x)+"px");v.reflowResizeOverlay(t)};i.on("mousemove",e);tt(i,"mouseup",function(n){n.preventDefault();n.stopPropagation();i.off("mousemove",e);v.$apply(function(){v.hidePopover();v.updateTaBindtaTextElement()},100)});r.stopPropagation();r.preventDefault()};v.displayElements.resize.anchors[3].off("mousedown");v.displayElements.resize.anchors[3].on("mousedown",st);v.reflowResizeOverlay(t);tt(i,"click",function(){v.hideResizeOverlay()})};v.hideResizeOverlay=function(){v.displayElements.resize.anchors[3].off("mousedown",st);v.displayElements.resize.overlay.css("display","")};v.setup.htmlEditorSetup(v.displayElements.html);v.setup.textEditorSetup(v.displayElements.text);v.displayElements.html.attr({id:"taHtmlElement"+b,"ng-show":"showHtml","ta-bind":"ta-bind","ng-model":"html","ng-model-options":y.attr("ng-model-options")});v.displayElements.text.attr({id:"taTextElement"+b,contentEditable:"true","ta-bind":"ta-bind","ng-model":"html","ng-model-options":y.attr("ng-model-options")});v.displayElements.scrollWindow.attr({"ng-hide":"showHtml"});p.taDefaultWrap&&v.displayElements.text.attr("ta-default-wrap",p.taDefaultWrap);p.taUnsafeSanitizer&&(v.displayElements.text.attr("ta-unsafe-sanitizer",p.taUnsafeSanitizer),v.displayElements.html.attr("ta-unsafe-sanitizer",p.taUnsafeSanitizer));v.displayElements.scrollWindow.append(v.displayElements.text);y.append(v.displayElements.scrollWindow);y.append(v.displayElements.html);v.displayElements.forminput.attr("name",v._name);y.append(v.displayElements.forminput);p.tabindex&&(y.removeAttr("tabindex"),v.displayElements.text.attr("tabindex",p.tabindex),v.displayElements.html.attr("tabindex",p.tabindex));p.placeholder&&(v.displayElements.text.attr("placeholder",p.placeholder),v.displayElements.html.attr("placeholder",p.placeholder));p.taDisabled&&(v.displayElements.text.attr("ta-readonly","disabled"),v.displayElements.html.attr("ta-readonly","disabled"),v.disabled=v.$parent.$eval(p.taDisabled),v.$parent.$watch(p.taDisabled,function(n){v.disabled=n;v.disabled?y.addClass(v.classes.disabled):y.removeClass(v.classes.disabled)}));p.taPaste&&(v._pasteHandler=function(n){return a(p.taPaste)(v.$parent,{$html:n})},v.displayElements.text.attr("ta-paste","_pasteHandler($html)"));t(v.displayElements.scrollWindow)(v);t(v.displayElements.html)(v);v.updateTaBindtaTextElement=v["updateTaBindtaTextElement"+b];v.updateTaBindtaHtmlElement=v["updateTaBindtaHtmlElement"+b];y.addClass("ta-root");v.displayElements.scrollWindow.addClass("ta-text ta-editor "+v.classes.textEditor);v.displayElements.html.addClass("ta-html ta-editor "+v.classes.htmlEditor);v._actionRunning=!1;g=!1;v.startAction=function(){return v._actionRunning=!0,g=o.rangy.saveSelection(),function(){g&&o.rangy.restoreSelection(g)}};v.endAction=function(){v._actionRunning=!1;g&&(v.showHtml?v.displayElements.html[0].focus():v.displayElements.text[0].focus(),o.rangy.removeMarkers(g));g=!1;v.updateSelectedStyles();v.showHtml||v["updateTaBindtaTextElement"+b]()};et=function(){v.focussed=!0;y.addClass(v.classes.focussed);d.focus();y.triggerHandler("focus")};v.displayElements.html.on("focus",et);v.displayElements.text.on("focus",et);ot=function(n){return v._actionRunning||s[0].activeElement===v.displayElements.html[0]||s[0].activeElement===v.displayElements.text[0]||(y.removeClass(v.classes.focussed),d.unfocus(),i(function(){v._bUpdateSelectedStyles=!1;y.triggerHandler("blur");v.focussed=!1},0)),n.preventDefault(),!1};v.displayElements.html.on("blur",ot);v.displayElements.text.on("blur",ot);v.displayElements.text.on("paste",function(n){y.triggerHandler("paste",n)});v.queryFormatBlockState=function(n){return!v.showHtml&&n.toLowerCase()===s[0].queryCommandValue("formatBlock").toLowerCase()};v.queryCommandState=function(n){return v.showHtml?"":s[0].queryCommandState(n)};v.switchView=function(){v.showHtml=!v.showHtml;h.enabled(!1,v.displayElements.html);h.enabled(!1,v.displayElements.text);v.showHtml?i(function(){return v.html=v.displayElements.text.html(),h.enabled(!0,v.displayElements.html),h.enabled(!0,v.displayElements.text),v.displayElements.html[0].focus()},100):i(function(){return v.html=v.displayElements.text.html(),h.enabled(!0,v.displayElements.html),h.enabled(!0,v.displayElements.text),v.displayElements.text[0].focus()},100)};p.ngModel?(ct=!0,w.$render=function(){if(ct){ct=!1;var n=v.$parent.$eval(p.ngModel);(n===undefined||n===null)&&nt&&nt!==""&&w.$setViewValue(nt)}v.displayElements.forminput.val(w.$viewValue);v.html=w.$viewValue||""},y.attr("required")&&(w.$validators.required=function(n,t){var i=n||t;return!(!i||i.trim()==="")})):(v.displayElements.forminput.val(nt),v.html=nt);v.$watch("html",function(n,t){n!==t&&(p.ngModel&&w.$viewValue!==n&&w.$setViewValue(n),v.displayElements.forminput.val(n))});p.taTargetToolbars?d=e.registerEditor(v._name,v,p.taTargetToolbars.split(",")):(k=n.element('<div text-angular-toolbar name="textAngularToolbar'+b+'">'),p.taToolbar&&k.attr("ta-toolbar",p.taToolbar),p.taToolbarClass&&k.attr("ta-toolbar-class",p.taToolbarClass),p.taToolbarGroupClass&&k.attr("ta-toolbar-group-class",p.taToolbarGroupClass),p.taToolbarButtonClass&&k.attr("ta-toolbar-button-class",p.taToolbarButtonClass),p.taToolbarActiveButtonClass&&k.attr("ta-toolbar-active-button-class",p.taToolbarActiveButtonClass),p.taFocussedClass&&k.attr("ta-focussed-class",p.taFocussedClass),y.prepend(k),t(k)(v.$parent),d=e.registerEditor(v._name,v,["textAngularToolbar"+b]));v.$on("$destroy",function(){e.unregisterEditor(v._name);n.element(window).off("blur")});v.$on("ta-element-select",function(n,t){d.triggerElementSelect(n,t)&&v["reApplyOnSelectorHandlerstaTextElement"+b]()});v.$on("ta-drop-event",function(t,r,u,f){v.displayElements.text[0].focus();f&&f.files&&f.files.length>0?(n.forEach(f.files,function(n){try{l.when(v.fileDropHandler(n,v.wrapSelection)||v.fileDropHandler!==v.defaultFileDropHandler&&l.when(v.defaultFileDropHandler(n,v.wrapSelection))).then(function(){v["updateTaBindtaTextElement"+b]()})}catch(t){c.error(t)}}),u.preventDefault(),u.stopPropagation()):i(function(){v["updateTaBindtaTextElement"+b]()},0)});v._bUpdateSelectedStyles=!1;n.element(window).on("blur",function(){v._bUpdateSelectedStyles=!1;v.focussed=!1});v.updateSelectedStyles=function(){var t;ht&&i.cancel(ht);(t=u.getSelectionElement())!==undefined&&t.parentNode!==v.displayElements.text[0]?d.updateSelectedStyles(n.element(t)):d.updateSelectedStyles();v._bUpdateSelectedStyles&&(ht=i(v.updateSelectedStyles,200))};it=function(){if(!v.focussed){v._bUpdateSelectedStyles=!1;return}v._bUpdateSelectedStyles||(v._bUpdateSelectedStyles=!0,v.$apply(function(){v.updateSelectedStyles()}))};v.displayElements.html.on("keydown",it);v.displayElements.text.on("keydown",it);rt=function(){v._bUpdateSelectedStyles=!1};v.displayElements.html.on("keyup",rt);v.displayElements.text.on("keyup",rt);ut=function(t,i){i&&n.extend(t,i);v.$apply(function(){if(d.sendKeyCommand(t))return v._bUpdateSelectedStyles||v.updateSelectedStyles(),t.preventDefault(),!1})};v.displayElements.html.on("keypress",ut);v.displayElements.text.on("keypress",ut);ft=function(){v._bUpdateSelectedStyles=!1;v.$apply(function(){v.updateSelectedStyles()})};v.displayElements.html.on("mouseup",ft);v.displayElements.text.on("mouseup",ft)}}}]);e.service("textAngularManager",["taToolExecuteAction","taTools","taRegisterTool",function(t,i,r){var u={},f={};return{registerEditor:function(r,e,o){if(!r||r==="")throw"textAngular Error: An editor requires a name";if(!e)throw"textAngular Error: An editor requires a scope";if(f[r])throw'textAngular Error: An Editor with name "'+r+'" already exists';var s=[];return n.forEach(o,function(n){u[n]&&s.push(u[n])}),f[r]={scope:e,toolbars:o,_registerToolbar:function(n){this.toolbars.indexOf(n.name)>=0&&s.push(n)},editorFunctions:{disable:function(){n.forEach(s,function(n){n.disabled=!0})},enable:function(){n.forEach(s,function(n){n.disabled=!1})},focus:function(){n.forEach(s,function(n){n._parent=e;n.disabled=!1;n.focussed=!0;e.focussed=!0})},unfocus:function(){n.forEach(s,function(n){n.disabled=!0;n.focussed=!1});e.focussed=!1},updateSelectedStyles:function(t){n.forEach(s,function(i){n.forEach(i.tools,function(n){n.activeState&&(i._parent=e,n.active=n.activeState(t))})})},sendKeyCommand:function(r){var u=!1;return(r.ctrlKey||r.metaKey||r.specialKey)&&n.forEach(i,function(n,i){if(n.commandKeyCode&&(n.commandKeyCode===r.which||n.commandKeyCode===r.specialKey))for(var f=0;f<s.length;f++)if(s[f].tools[i]!==undefined){t.call(s[f].tools[i],e);u=!0;break}}),u},triggerElementSelect:function(t,r){var c=function(n,t){for(var i=!0,r=0;r<t.length;r++)i=i&&n.attr(t[r]);return i},u=[],l={},a=!1,h,f,y,v,o;if(r=n.element(r),h=!1,n.forEach(i,function(t,i){t.onElementSelect&&t.onElementSelect.element&&t.onElementSelect.element.toLowerCase()===r[0].tagName.toLowerCase()&&(!t.onElementSelect.filter||t.onElementSelect.filter(r))&&(h=h||n.isArray(t.onElementSelect.onlyWithAttrs)&&c(r,t.onElementSelect.onlyWithAttrs),(!t.onElementSelect.onlyWithAttrs||c(r,t.onElementSelect.onlyWithAttrs))&&(l[i]=t))}),h?(n.forEach(l,function(n,t){n.onElementSelect.onlyWithAttrs&&c(r,n.onElementSelect.onlyWithAttrs)&&u.push({name:t,tool:n})}),u.sort(function(n,t){return t.tool.onElementSelect.onlyWithAttrs.length-n.tool.onElementSelect.onlyWithAttrs.length})):n.forEach(l,function(n,t){u.push({name:t,tool:n})}),u.length>0)for(f=0;f<u.length;f++){for(y=u[f].tool,v=u[f].name,o=0;o<s.length;o++)if(s[o].tools[v]!==undefined){y.onElementSelect.action.call(s[o].tools[v],t,r,e);a=!0;break}if(a)break}return a}}},f[r].editorFunctions},retrieveEditor:function(n){return f[n]},unregisterEditor:function(n){delete f[n]},registerToolbar:function(t){if(!t)throw"textAngular Error: A toolbar requires a scope";if(!t.name||t.name==="")throw"textAngular Error: A toolbar requires a name";if(u[t.name])throw'textAngular Error: A toolbar with name "'+t.name+'" already exists';u[t.name]=t;n.forEach(f,function(n){n._registerToolbar(t)})},retrieveToolbar:function(n){return u[n]},retrieveToolbarsViaEditor:function(t){var i=[],r=this;return n.forEach(this.retrieveEditor(t).toolbars,function(n){i.push(r.retrieveToolbar(n))}),i},unregisterToolbar:function(n){delete u[n]},updateToolsDisplay:function(t){var i=this;n.forEach(t,function(n,t){i.updateToolDisplay(t,n)})},resetToolsDisplay:function(){var t=this;n.forEach(i,function(n,i){t.resetToolDisplay(i)})},updateToolDisplay:function(t,i){var r=this;n.forEach(u,function(n,u){r.updateToolbarToolDisplay(u,t,i)})},resetToolDisplay:function(t){var i=this;n.forEach(u,function(n,r){i.resetToolbarToolDisplay(r,t)})},updateToolbarToolDisplay:function(n,t,i){if(u[n])u[n].updateToolDisplay(t,i);else throw'textAngular Error: No Toolbar with name "'+n+'" exists';},resetToolbarToolDisplay:function(n,t){if(u[n])u[n].updateToolDisplay(t,i[t],!0);else throw'textAngular Error: No Toolbar with name "'+n+'" exists';},removeTool:function(t){delete i[t];n.forEach(u,function(n){var r,i,u;for(delete n.tools[t],r=0;r<n.toolbar.length;r++){for(u=0;u<n.toolbar[r].length;u++){if(n.toolbar[r][u]===t){i={group:r,index:u};break}if(i!==undefined)break}i!==undefined&&(n.toolbar[i.group].slice(i.index,1),n._$element.children().eq(i.group).children().eq(i.index).remove())}})},addTool:function(t,i,f,e){r(t,i);n.forEach(u,function(n){n.addTool(t,i,f,e)})},addToolToToolbar:function(n,t,i,f,e){r(n,t);u[i].addTool(n,t,f,e)},refreshEditor:function(n){if(f[n])f[n].scope.updateTaBindtaTextElement(),f[n].scope.$$phase||f[n].scope.$digest();else throw'textAngular Error: No Editor with name "'+n+'" exists';},sendKeyCommand:function(n,t){var i=f[n._name];if(i&&i.editorFunctions.sendKeyCommand(t))return n._bUpdateSelectedStyles||n.updateSelectedStyles(),t.preventDefault(),!1}}}]);e.directive("textAngularToolbar",["$compile","textAngularManager","taOptions","taTools","taToolExecuteAction","$window",function(t,i,r,u,f,e){return{scope:{name:"@"},restrict:"EA",link:function(o,s,h){var c,l;if(!o.name||o.name==="")throw"textAngular Error: A toolbar requires a name";n.extend(o,n.copy(r));h.taToolbar&&(o.toolbar=o.$parent.$eval(h.taToolbar));h.taToolbarClass&&(o.classes.toolbar=h.taToolbarClass);h.taToolbarGroupClass&&(o.classes.toolbarGroup=h.taToolbarGroupClass);h.taToolbarButtonClass&&(o.classes.toolbarButton=h.taToolbarButtonClass);h.taToolbarActiveButtonClass&&(o.classes.toolbarButtonActive=h.taToolbarActiveButtonClass);h.taFocussedClass&&(o.classes.focussed=h.taFocussedClass);o.disabled=!0;o.focussed=!1;o._$element=s;s[0].innerHTML="";s.addClass("ta-toolbar "+o.classes.toolbar);o.$watch("focussed",function(){o.focussed?s.addClass(o.classes.focussed):s.removeClass(o.classes.focussed)});c=function(i,r){var u,e,f;return u=i&&i.display?n.element(i.display):n.element("<button type='button'>"),i&&i["class"]?u.addClass(i["class"]):u.addClass(o.classes.toolbarButton),u.attr("name",r.name),u.attr("ta-button","ta-button"),u.attr("ng-disabled","isDisabled()"),u.attr("tabindex","-1"),u.attr("ng-click","executeAction()"),u.attr("ng-class","displayActiveToolClass(active)"),i&&i.tooltiptext&&u.attr("title",i.tooltiptext),!i||i.display||r._display||(u[0].innerHTML="",i.buttontext&&(u[0].innerHTML=i.buttontext),i.iconclass&&(e=n.element("<i>"),f=u[0].innerHTML,e.addClass(i.iconclass),u[0].innerHTML="",u.append(e),f&&f!==""&&u.append("&nbsp;"+f))),r._lastToolDefinition=n.copy(i),t(u)(r)};o.tools={};o._parent={disabled:!0,showHtml:!1,queryFormatBlockState:function(){return!1},queryCommandState:function(){return!1}};l={$window:e,$editor:function(){return o._parent},isDisabled:function(){return typeof this.$eval("disabled")!="function"&&this.$eval("disabled")||this.$eval("disabled()")||this.name!=="html"&&this.$editor().showHtml||this.$parent.disabled||this.$editor().disabled},displayActiveToolClass:function(n){return n?o.classes.toolbarButtonActive:""},executeAction:f};n.forEach(o.toolbar,function(t){var i=n.element("<div>");i.addClass(o.classes.toolbarGroup);n.forEach(t,function(t){o.tools[t]=n.extend(o.$new(!0),u[t],l,{name:t});o.tools[t].$element=c(u[t],o.tools[t]);i.append(o.tools[t].$element)});s.append(i)});o.updateToolDisplay=function(t,i,r){var u=o.tools[t],f;if(u){if(u._lastToolDefinition&&!r&&(i=n.extend({},u._lastToolDefinition,i)),i.buttontext===null&&i.iconclass===null&&i.display===null)throw'textAngular Error: Tool Definition for updating "'+t+'" does not have a valid display/iconclass/buttontext value';i.buttontext===null&&delete i.buttontext;i.iconclass===null&&delete i.iconclass;i.display===null&&delete i.display;f=c(i,u);u.$element.replaceWith(f);u.$element=f}};o.addTool=function(t,i,r,f){o.tools[t]=n.extend(o.$new(!0),u[t],l,{name:t});o.tools[t].$element=c(u[t],o.tools[t]);var e;r===undefined&&(r=o.toolbar.length-1);e=n.element(s.children()[r]);f===undefined?(e.append(o.tools[t].$element),o.toolbar[r][o.toolbar[r].length-1]=t):(e.children().eq(f).after(o.tools[t].$element),o.toolbar[r][f]=t)};i.registerToolbar(o);o.$on("$destroy",function(){i.unregisterToolbar(o.name)})}}}])}(dnnsfAngular15);
//# sourceMappingURL=textAngular.min.js.map
