/**
 * WYSIWYG – jQuery plugin 0.99.dev
 *
 * Copyright © 2008–2009 Juan M Martinez, 2010–2014 Akzhan Abdulin and all contributors
 * https://github.com/jwysiwyg/jwysiwyg
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
 * Release: 2014-10-24
 *
 */
/*jslint browser: true, forin: true, white: true */
!function(l,c,d){!function(u){var t,e,r=l.console||{log:u.noop,error:function(t){u.error(t)}},i=u.fn.prop!==d&&u.fn.removeProp!==d;function o(){this.controls={bold:{groupIndex:0,visible:!0,tags:["b","strong"],css:{fontWeight:"bold"},tooltip:"Bold",hotkey:{ctrl:1,key:66}},copy:{groupIndex:8,visible:!1,tooltip:"Copy"},createLink:{groupIndex:6,visible:!0,exec:function(){var t=this;u.wysiwyg.controls&&u.wysiwyg.controls.link?u.wysiwyg.controls.link.init(this):u.wysiwyg.autoload?u.wysiwyg.autoload.control("wysiwyg.link.js",function(){t.controls.createLink.exec.apply(t)}):r.error("$.wysiwyg.controls.link not defined. You need to include wysiwyg.link.js file")},tags:["a"],tooltip:"Create link"},unLink:{groupIndex:6,visible:!0,exec:function(){this.editorDoc.execCommand("unlink",!1,null)},tooltip:"Remove link"},cut:{groupIndex:8,visible:!1,tooltip:"Cut"},decreaseFontSize:{groupIndex:9,visible:!1,tags:["small"],tooltip:"Decrease font size",exec:function(){this.decreaseFontSize()}},h1:{groupIndex:7,visible:!0,className:"h1",command:u.browser.mozilla?"heading":"FormatBlock",arguments:u.browser.mozilla?"h1":"<h1>",tags:["h1"],tooltip:"Header 1"},h2:{groupIndex:7,visible:!0,className:"h2",command:u.browser.mozilla?"heading":"FormatBlock",arguments:u.browser.mozilla?"h2":"<h2>",tags:["h2"],tooltip:"Header 2"},h3:{groupIndex:7,visible:!0,className:"h3",command:u.browser.mozilla?"heading":"FormatBlock",arguments:u.browser.mozilla?"h3":"<h3>",tags:["h3"],tooltip:"Header 3"},highlight:{tooltip:"Highlight",className:"highlight",groupIndex:1,visible:!1,css:{backgroundColor:"rgb(255, 255, 102)"},exec:function(){var t,e,i,o;if(t=u.browser.msie||u.browser.opera?"backcolor":"hilitecolor",u.browser.msie)e=this.getInternalRange().parentElement();else for(e=(i=this.getInternalSelection()).extentNode||i.focusNode;e.style===d;)if((e=e.parentNode).tagName&&"body"===e.tagName.toLowerCase())return;o="rgb(255, 255, 102)"===e.style.backgroundColor||"#ffff66"===e.style.backgroundColor?"#ffffff":"#ffff66",this.editorDoc.execCommand(t,!1,o)}},html:{groupIndex:10,visible:!1,exec:function(t,e){var i;this.options.resizeOptions&&u.fn.resizable&&(i=this.element.height()),this.viewHTML?(this.setContent("function"==typeof e?e(this.original.value):this.original.value),u(this.original).hide(),this.editor.show(),this.options.resizeOptions&&u.fn.resizable&&(i===this.element.height()&&this.element.height(i+this.editor.height()),this.element.resizable(u.extend(!0,{alsoResize:this.editor},this.options.resizeOptions))),this.ui.toolbar.find("li").each(function(){var t=u(this);t.hasClass("html")?t.removeClass("active"):t.removeClass("disabled")})):(this.saveContent(t),u(this.original).css({width:this.editor.width(),height:this.editor.height(),resize:"none"}).show(),this.editor.hide(),this.options.resizeOptions&&u.fn.resizable&&(i===this.element.height()&&this.element.height(this.ui.toolbar.height()),this.element.resizable("destroy")),this.ui.toolbar.find("li").each(function(){var t=u(this);t.hasClass("html")?t.addClass("active"):!1===t.hasClass("fullscreen")&&t.removeClass("active").addClass("disabled")})),this.viewHTML=!this.viewHTML},tooltip:"View source code"},increaseFontSize:{groupIndex:9,visible:!1,tags:["big"],tooltip:"Increase font size",exec:function(){this.increaseFontSize()}},indent:{groupIndex:2,visible:!0,tooltip:"Indent"},insertHorizontalRule:{groupIndex:6,visible:!0,tags:["hr"],tooltip:"Insert Horizontal Rule"},insertImage:{groupIndex:6,visible:!0,exec:function(){var t=this;u.wysiwyg.controls&&u.wysiwyg.controls.image?u.wysiwyg.controls.image.init(this):u.wysiwyg.autoload?u.wysiwyg.autoload.control("wysiwyg.image.js",function(){t.controls.insertImage.exec.apply(t)}):r.error("$.wysiwyg.controls.image not defined. You need to include wysiwyg.image.js file")},tags:["img"],tooltip:"Insert image"},insertOrderedList:{groupIndex:5,visible:!0,tags:["ol"],tooltip:"Insert Ordered List"},insertTable:{groupIndex:6,visible:!0,exec:function(){var t=this;u.wysiwyg.controls&&u.wysiwyg.controls.table?u.wysiwyg.controls.table(this):u.wysiwyg.autoload?u.wysiwyg.autoload.control("wysiwyg.table.js",function(){t.controls.insertTable.exec.apply(t)}):r.error("$.wysiwyg.controls.table not defined. You need to include wysiwyg.table.js file")},tags:["table"],tooltip:"Insert table"},insertUnorderedList:{groupIndex:5,visible:!0,tags:["ul"],tooltip:"Insert Unordered List"},italic:{groupIndex:0,visible:!0,tags:["i","em"],css:{fontStyle:"italic"},tooltip:"Italic",hotkey:{ctrl:1,key:73}},justifyCenter:{groupIndex:1,visible:!0,tags:["center"],css:{textAlign:"center"},tooltip:"Justify Center"},justifyFull:{groupIndex:1,visible:!0,css:{textAlign:"justify"},tooltip:"Justify Full"},justifyLeft:{visible:!0,groupIndex:1,css:{textAlign:"left"},tooltip:"Justify Left"},justifyRight:{groupIndex:1,visible:!0,css:{textAlign:"right"},tooltip:"Justify Right"},ltr:{groupIndex:10,visible:!1,exec:function(){var t=this.dom.getElement("p");return!!t&&(u(t).attr("dir","ltr"),!0)},tooltip:"Left to Right"},outdent:{groupIndex:2,visible:!0,tooltip:"Outdent"},paragraph:{groupIndex:7,visible:!1,className:"paragraph",command:"FormatBlock",arguments:u.browser.msie||u.browser.opera?"<p>":"p",tags:["p"],tooltip:"Paragraph"},paste:{groupIndex:8,visible:!1,tooltip:"Paste"},redo:{groupIndex:4,visible:!0,tooltip:"Redo"},removeFormat:{groupIndex:10,visible:!0,exec:function(){this.removeFormat()},tooltip:"Remove formatting"},rtl:{groupIndex:10,visible:!1,exec:function(){var t=this.dom.getElement("p");return!!t&&(u(t).attr("dir","rtl"),!0)},tooltip:"Right to Left"},strikeThrough:{groupIndex:0,visible:!0,tags:["s","strike"],css:{textDecoration:"line-through"},tooltip:"Strike-through"},subscript:{groupIndex:3,visible:!0,tags:["sub"],tooltip:"Subscript"},superscript:{groupIndex:3,visible:!0,tags:["sup"],tooltip:"Superscript"},underline:{groupIndex:0,visible:!0,tags:["u"],css:{textDecoration:"underline"},tooltip:"Underline",hotkey:{ctrl:1,key:85}},undo:{groupIndex:4,visible:!0,tooltip:"Undo"},code:{visible:!0,groupIndex:6,tooltip:"Code snippet",exec:function(){var t=this.getInternalRange(),e=u(t.commonAncestorContainer),i=t.commonAncestorContainer.nodeName.toLowerCase();e.parent("code").length?e.unwrap():"body"!==i&&e.wrap("<code/>")}},cssWrap:{visible:!1,groupIndex:6,tooltip:"CSS Wrapper",exec:function(){u.wysiwyg.controls.cssWrap.init(this)}}},this.defaults={html:'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" style="margin:0"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></head><body style="margin:0;">INITIAL_CONTENT</body></html>',debug:!1,controls:{},css:!1,events:{},autoGrow:!1,autoSave:!0,brIE:!1,formHeight:270,formWidth:440,iFrameClass:null,initialContent:"<p>Initial content</p>",maxHeight:1e4,maxLength:0,messages:{nonSelection:"Select the text you wish to link"},toolbarHtml:'<ul role="menu" class="toolbar"></ul>',removeHeadings:!1,replaceDivWithP:!1,resizeOptions:!1,rmUnusedControls:!1,rmUnwantedBr:!0,tableFiller:"Lorem ipsum",initialMinHeight:null,controlImage:{forceRelativeUrls:!1},controlLink:{forceRelativeUrls:!1},plugins:{autoload:!1,i18n:!1,rmFormat:{rmMsWordMarkup:!1}},dialog:"default"},this.availableControlProperties=["arguments","callback","callbackArguments","className","command","css","custom","exec","groupIndex","hotkey","icon","separator","tags","tooltip","visible"],this.editor=null,this.editorDoc=null,this.element=null,this.options={},this.original=null,this.savedRange=null,this.timers=[],this.validKeyCodes=[8,9,13,16,17,18,19,20,27,33,34,35,36,37,38,39,40,45,46],this.isDestroyed=!1,this.dom={ie:{parent:null},w3c:{parent:null}},(this.dom.parent=this).dom.ie.parent=this.dom,this.dom.w3c.parent=this.dom,this.ui={},(this.ui.self=this).ui.toolbar=null,this.ui.initialHeight=null,this.dom.getAncestor=function(t,e){for(e=e.toLowerCase();t&&t.tagName!==d&&"body"!==t.tagName.toLowerCase();){if(e===t.tagName.toLowerCase())return t;t=t.parentNode}if(!t.tagName&&(t.previousSibling||t.nextSibling)){if(t.previousSibling&&t.previousSibling.tagName.toLowerCase()===e)return t.previousSibling;if(t.nextSibling&&t.nextSibling.tagName.toLowerCase()===e)return t.nextSibling}return null},this.dom.getElement=function(t){return t=t.toLowerCase(),l.getSelection?this.w3c.getElement(t):this.ie.getElement(t)},this.dom.ie.getElement=function(t){var e,i=this.parent,o=i.parent.getInternalSelection(),n=o.createRange();if("Control"===o.type){if(1!==n.length)return null;e=n.item(0)}else e=n.parentElement();return i.getAncestor(e,t)},this.dom.w3c.getElement=function(t){var e,i=this.parent,o=i.parent.getInternalRange();if(!o)return null;if(3===(e=o.commonAncestorContainer).nodeType&&(e=e.parentNode),e===o.startContainer&&(e=e.childNodes[o.startOffset]),!e.tagName&&(e.previousSibling||e.nextSibling)){if(e.previousSibling&&e.previousSibling.tagName.toLowerCase()===t)return e.previousSibling;if(e.nextSibling&&e.nextSibling.tagName.toLowerCase()===t)return e.nextSibling}return i.getAncestor(e,t)},this.ui.addHoverClass=function(){u(this).addClass("wysiwyg-button-hover")},this.ui.appendControls=function(){var t,i,o=this,e=this.self.parseControls(),n=!0,s=[],r={},a=function(t,e){e.groupIndex&&i!==e.groupIndex&&(i=e.groupIndex,n=!1),e.visible&&(n||(o.appendItemSeparator(),n=!0),e.custom?o.appendItemCustom(t,e):o.appendItem(t,e))};for(u.each(e,function(t,e){var i="empty";d!==e.groupIndex&&(i=""===e.groupIndex?"empty":e.groupIndex),d===r[i]&&(s.push(i),r[i]={}),r[i][t]=e}),s.sort(function(t,e){return"number"==typeof t&&"number"==typeof e?t-e:(t=t.toString(),(e=e.toString())<t?1:t===e?0:-1)}),0<s.length&&(i=s[0]),t=0;t<s.length;t+=1)u.each(r[s[t]],a)},this.ui.appendItem=function(o,n){var s=this.self,t=n.className||n.command||o||"empty",e=n.tooltip||n.command||o||"";return u('<li role="menuitem" unselectable="on">'+t+"</li>").addClass(t).attr("title",e).hover(this.addHoverClass,this.removeHoverClass).click(function(t){if(u(this).hasClass("disabled"))return!1;s.triggerControl(o,n);var e=u(t.target);for(var i in s.controls)if(e.hasClass(i)){s.ui.toolbar.find("."+i).toggleClass("active"),s.editorDoc.rememberCommand=!0;break}return this.blur(),s.ui.returnRange(),s.ui.focus(),!0}).appendTo(s.ui.toolbar)},this.ui.appendItemCustom=function(t,e){var i=this.self,o=e.tooltip||e.command||t||"";return e.callback&&u(l).bind("trigger-"+t+".wysiwyg",e.callback),u('<li role="menuitem" unselectable="on" style="background: url(\''+e.icon+"') no-repeat;\"></li>").addClass("custom-command-"+t).addClass("wysiwyg-custom-command").addClass(t).attr("title",o).hover(this.addHoverClass,this.removeHoverClass).click(function(){return!u(this).hasClass("disabled")&&(i.triggerControl.apply(i,[t,e]),this.blur(),i.ui.returnRange(),i.ui.focus(),i.triggerControlCallback(t),!0)}).appendTo(i.ui.toolbar)},this.ui.appendItemSeparator=function(){var t=this.self;return u('<li role="separator" class="separator"></li>').appendTo(t.ui.toolbar)},this.autoSaveFunction=function(){this.saveContent()},this.ui.checkTargets=function(l){var c=this.self;u.each(c.options.controls,function(t,e){var i,o,n,s,r=e.className||e.command||t||"empty",a=function(t){var i=0,o=0;u.each(t,function(t,e){"function"==typeof e?e.apply(c,[s.css(t).toString().toLowerCase(),c])&&(i+=1):s.css(t).toString().toLowerCase()===e&&(i+=1),o+=1}),o===i&&c.ui.toolbar.find("."+r).addClass("active")};if("fullscreen"!==r&&c.ui.toolbar.find("."+r).removeClass("active"),e.tags||e.options&&e.options.tags)for(i=e.tags||e.options&&e.options.tags,o=l;o&&1===o.nodeType;)-1!==u.inArray(o.tagName.toLowerCase(),i)&&c.ui.toolbar.find("."+r).addClass("active"),o=o.parentNode;if(e.css||e.options&&e.options.css)for(n=e.css||e.options&&e.options.css,s=u(l);s&&1===s[0].nodeType;)a(n),s=s.parent()})},this.ui.designMode=function(){var e,i=this.self;(e=function(t){if("on"===i.editorDoc.designMode)return i.timers.designMode&&l.clearTimeout(i.timers.designMode),void(i.innerDocument()!==i.editorDoc&&i.ui.initFrame());try{i.editorDoc.designMode="on"}catch(t){}0<(t-=1)&&(i.timers.designMode=l.setTimeout(function(){e(t)},100))})(3)},this.destroy=function(){this.isDestroyed=!0;var t,e=this.element.closest("form");for(t=0;t<this.timers.length;t+=1)l.clearTimeout(this.timers[t]);return u(this.original).appendTo(u(this.element.parent())),e.unbind(".wysiwyg"),this.element.remove(),u.removeData(this.original,"wysiwyg"),u(this.original).show(),this},this.getRangeText=function(){var t=this.getInternalRange();return t&&(t.toString?t=t.toString():t.text&&(t=t.text)),t},this.execute=function(t,e){void 0===e&&(e=null),this.editorDoc.execCommand(t,!1,e)},this.extendOptions=function(e){var i={};return"object"==typeof e.controls&&(i=e.controls,delete e.controls),(e=u.extend(!0,{},this.defaults,e)).controls=u.extend(!0,{},i,this.controls,i),e.rmUnusedControls&&u.each(e.controls,function(t){i[t]||delete e.controls[t]}),e},this.ui.focus=function(){var t=this.self;return t.editor.get(0).contentWindow.focus(),t},this.ui.returnRange=function(){var t,e=this.self;if(null!==e.savedRange){if(l.getSelection){0<(t=l.getSelection()).rangeCount&&t.removeAllRanges();try{t.addRange(e.savedRange)}catch(t){r.error(t)}}else l.document.createRange?l.getSelection().addRange(e.savedRange):l.document.selection&&e.savedRange.select();e.savedRange=null}},this.increaseFontSize=function(){if(u.browser.mozilla||u.browser.opera)this.editorDoc.execCommand("increaseFontSize",!1,null);else if(u.browser.webkit){var t=this.getInternalRange(),e=this.getInternalSelection(),i=this.editorDoc.createElement("big");if(!0===t.collapsed&&3===t.commonAncestorContainer.nodeType){var o=t.commonAncestorContainer.nodeValue.toString(),n=o.lastIndexOf(" ",t.startOffset)+1,s=-1===o.indexOf(" ",t.startOffset)?o:o.indexOf(" ",t.startOffset);t.setStart(t.commonAncestorContainer,n),t.setEnd(t.commonAncestorContainer,s),t.surroundContents(i),e.addRange(t)}else t.surroundContents(i),e.removeAllRanges(),e.addRange(t)}else r.error("Internet Explorer?")},this.decreaseFontSize=function(){if(u.browser.mozilla||u.browser.opera)this.editorDoc.execCommand("decreaseFontSize",!1,null);else if(u.browser.webkit){var t=this.getInternalRange(),e=this.getInternalSelection(),i=this.editorDoc.createElement("small");if(!0===t.collapsed&&3===t.commonAncestorContainer.nodeType){var o=t.commonAncestorContainer.nodeValue.toString(),n=o.lastIndexOf(" ",t.startOffset)+1,s=-1===o.indexOf(" ",t.startOffset)?o:o.indexOf(" ",t.startOffset);t.setStart(t.commonAncestorContainer,n),t.setEnd(t.commonAncestorContainer,s),t.surroundContents(i),e.addRange(t)}else t.surroundContents(i),e.removeAllRanges(),e.addRange(t)}else r.error("Internet Explorer?")},this.getContent=function(){return this.viewHTML&&this.setContent(this.original.value),this.events.filter("getContent",this.editorDoc.body.innerHTML)},this.events={_events:{},bind:function(t,e){"object"!=typeof this._events.eventName&&(this._events[t]=[]),this._events[t].push(e)},trigger:function(t,i){if("object"==typeof this._events.eventName){var o=this.editor;u.each(this._events[t],function(t,e){"function"==typeof e&&e.apply(o,i)})}},filter:function(t,i){if("object"==typeof this._events[t]){var o=this.editor,n=Array.prototype.slice.call(arguments,1);u.each(this._events[t],function(t,e){"function"==typeof e&&(i=e.apply(o,n))})}return i}},this.getElementByAttributeValue=function(t,e,i){var o,n,s=this.editorDoc.getElementsByTagName(t);for(o=0;o<s.length;o+=1)if(n=s[o].getAttribute(e),u.browser.msie&&(n=n.substr(n.length-i.length)),n===i)return s[o];return!1},this.getInternalRange=function(){var t=this.getInternalSelection();return t?t.rangeCount&&0<t.rangeCount?t.getRangeAt(0):t.createRange?t.createRange():null:null},this.getInternalSelection=function(){var t=this.editor.get(0).contentWindow;return t&&t.getSelection?t.getSelection():this.editorDoc.getSelection?this.editorDoc.getSelection():this.editorDoc.selection?this.editorDoc.selection:null},this.getRange=function(){var t=this.getSelection();if(!t)return null;if(t.rangeCount&&0<t.rangeCount)t.getRangeAt(0);else if(t.createRange)return t.createRange();return null},this.getSelection=function(){return l.getSelection&&null!==l.getSelection()&&l.getSelection().createRange?l.getSelection():l.document.selection},this.ui.grow=function(){var t=this.self,e=u(t.editorDoc.body),i=u.browser.msie?e[0].scrollHeight:e.height()+2+20,o=t.ui.initialHeight,n=Math.max(i,o);return n=Math.min(n,t.options.maxHeight),t.editor.attr("scrolling",n<t.options.maxHeight?"no":"auto"),e.css("overflow",n<t.options.maxHeight?"hidden":""),t.editor.get(0).height=n,t},this.init=function(t,e){var i=this,o=u(t).closest("form"),n=t.width||t.clientWidth||0,s=t.height||t.clientHeight||0;if(this.options=this.extendOptions(e),this.original=t,this.ui.toolbar=u(this.options.toolbarHtml),u.browser.msie&&parseInt(u.browser.version,10)<8&&(this.options.autoGrow=!1),0===n&&t.cols&&(n=8*t.cols+21),0===s&&t.rows&&(s=16*t.rows+16),this.editor=u("https:"===l.location.protocol?'<iframe src="javascript:false;"></iframe>':"<iframe></iframe>").attr("frameborder","0"),this.options.iFrameClass?this.editor.addClass(this.options.iFrameClass):(this.editor.css({minHeight:(s-6).toString()+"px",width:50<n?n.toString()+"px":""}),u.browser.msie&&parseInt(u.browser.version,10)<7&&this.editor.css("height",s.toString()+"px")),t.id){var r=t.id+"-wysiwyg-iframe";c.getElementById(r)||this.editor.attr("id",r)}this.editor.attr("tabindex",u(t).attr("tabindex")),this.element=u("<div/>").addClass("wysiwyg"),this.options.iFrameClass||this.element.css({width:0<n?n.toString()+"px":"100%"}),u(t).hide().before(this.element),this.viewHTML=!1,this.initialContent=u(t).val(),this.ui.initFrame(),this.options.resizeOptions&&u.fn.resizable&&this.element.resizable(u.extend(!0,{alsoResize:this.editor},this.options.resizeOptions)),this.options.autoSave&&o.bind("submit.wysiwyg",function(){i.autoSaveFunction()}),o.bind("reset.wysiwyg",function(){i.resetFunction()})},this.ui.initFrame=function(){var t,e,i,o,s=this.self;if(o=u('<div class="toolbar-wrap"><div style="clear: both">\x3c!-- --\x3e</div>').prepend(s.ui.toolbar),s.ui.appendControls(),s.element.append(o).append(s.editor).append(s.original),s.editorDoc=s.innerDocument(),s.isDestroyed)return null;if(s.ui.designMode(),s.editorDoc.open(),s.editorDoc.write(s.options.html.replace(/INITIAL_CONTENT/,function(){return s.wrapInitialContent()})),s.editorDoc.close(),u.wysiwyg.plugin.bind(s),u(s.editorDoc).trigger("initFrame.wysiwyg"),u(s.editorDoc).bind("click.wysiwyg",function(t){s.ui.checkTargets(t.target?t.target:t.srcElement)}),u(s.original).focus(function(){0===u(this).filter(":visible").length||u.browser.opera||s.ui.focus()}),u(u.wysiwyg.quirk.quirks).each(function(t,e){e.init(s)}),u(s.editorDoc).keydown(function(t){return 8===t.keyCode&&/^<([\w]+)[^>]*>(<br\/?>)?<\/\1>$/.test(s.getContent())?(t.stopPropagation(),!1):!(s.editorDoc.rememberCommand=!1)}),u.browser.msie||u(s.editorDoc).keydown(function(t){var e,i;if(t.ctrlKey||t.metaKey)for(e in s.options.controls)if((i=s.options.controls[e]).hotkey&&i.hotkey.ctrl&&t.keyCode===i.hotkey.key)return s.triggerControl.apply(s,[e,i]),!1;return!0}),s.options.brIE&&u(s.editorDoc).keydown(function(t){if(13===t.keyCode){if(u.browser.msie||u.browser.opera){var e=s.getRange();e?(e.pasteHTML("<br/>"),e.collapse(!1),e.select()):s.insertHtml("<br/>")}else{var i=s.editorDoc.getSelection();if(!(i&&i.getRangeAt&&i.rangeCount))return!0;var o=i.getRangeAt(0);if(!o)return!0;var n=c.createElement("br");o.deleteContents(),o.insertNode(n),o.setStartAfter(n),o.collapse(!0),i.removeAllRanges(),i.addRange(o)}return!1}return!0}),s.options.plugins.rmFormat.rmMsWordMarkup&&u(s.editorDoc).bind("paste.wysiwyg",function(t){u.wysiwyg.rmFormat&&("object"==typeof s.options.plugins.rmFormat.rmMsWordMarkup?u.wysiwyg.rmFormat.run(s,{rules:{msWordMarkup:s.options.plugins.rmFormat.rmMsWordMarkup}}):u.wysiwyg.rmFormat.run(s,{rules:{msWordMarkup:{enabled:!0}}}))}),s.options.autoSave&&u(s.editorDoc).keydown(function(){s.autoSaveFunction()}).keyup(function(){s.autoSaveFunction()}).mousedown(function(){s.autoSaveFunction()}).bind(u.support.noCloneEvent?"input.wysiwyg":"paste.wysiwyg",function(){s.autoSaveFunction()}),s.options.autoGrow&&(null!==s.options.initialMinHeight?s.ui.initialHeight=s.options.initialMinHeight:s.ui.initialHeight=u(s.editorDoc).height(),u(s.editorDoc.body).css("border","1px solid white"),e=function(){s.ui.grow()},u(s.editorDoc).keyup(e),u(s.editorDoc).bind("editorRefresh.wysiwyg",e),s.ui.grow()),s.options.css)if(String===s.options.css.constructor&&(s.options.css=s.options.css.split()),Array===s.options.css.constructor){var n={};for(var r in s.options.css)Object===s.options.css[r].constructor?u.extend(n,s.options.css[r]):String===s.options.css[r].constructor&&(u.browser.msie?(t=s.editorDoc.createStyleSheet(s.options.css[r]),u(t).attr({media:"all"})):(t=u("<link/>").attr({href:s.options.css[r],media:"all",rel:"stylesheet",type:"text/css"}),u(s.editorDoc).find("head").append(t)));s.timers.initFrame_Css=l.setTimeout(function(t){u(s.editorDoc.body).css(n)},0),delete n}else Object===s.options.css.constructor&&(s.timers.initFrame_Css=l.setTimeout(function(){u(s.editorDoc.body).css(s.options.css)},0));if(0===s.initialContent.length&&("function"==typeof s.options.initialContent?s.setContent(s.options.initialContent()):s.setContent(s.options.initialContent)),0<s.options.maxLength&&u(s.editorDoc).keydown(function(t){u(s.editorDoc).text().length>=s.options.maxLength&&-1===u.inArray(t.which,s.validKeyCodes)&&t.preventDefault()}),u.each(s.options.events,function(t,e){u(s.editorDoc).bind(t+".wysiwyg",function(t){e.apply(s.editorDoc,[t,s])})}),u.browser.msie?u(s.editorDoc).bind("beforedeactivate.wysiwyg",function(){s.savedRange=s.getInternalRange()}):u(s.editorDoc).bind("blur.wysiwyg",function(){s.savedRange=s.getInternalRange()}),u(s.editorDoc.body).addClass("wysiwyg"),s.options.events&&s.options.events.save&&(i=s.options.events.save,u(s.editorDoc).bind("keyup.wysiwyg",i),u(s.editorDoc).bind("change.wysiwyg",i),u.support.noCloneEvent?u(s.editorDoc).bind("input.wysiwyg",i):(u(s.editorDoc).bind("paste.wysiwyg",i),u(s.editorDoc).bind("cut.wysiwyg",i))),s.options.xhtml5&&s.options.unicode){var a={ne:8800,le:8804,para:182,xi:958,darr:8595,nu:957,oacute:243,Uacute:218,omega:969,prime:8242,pound:163,igrave:236,thorn:254,forall:8704,emsp:8195,lowast:8727,brvbar:166,alefsym:8501,nbsp:160,delta:948,clubs:9827,lArr:8656,Omega:937,Auml:196,cedil:184,and:8743,plusmn:177,ge:8805,raquo:187,uml:168,equiv:8801,laquo:171,rdquo:8221,Epsilon:917,divide:247,fnof:402,chi:967,Dagger:8225,iacute:237,rceil:8969,sigma:963,Oslash:216,acute:180,frac34:190,lrm:8206,upsih:978,Scaron:352,part:8706,exist:8707,nabla:8711,image:8465,prop:8733,zwj:8205,omicron:959,aacute:225,Yuml:376,Yacute:221,weierp:8472,rsquo:8217,otimes:8855,kappa:954,thetasym:977,harr:8596,Ouml:214,Iota:921,ograve:242,sdot:8901,copy:169,oplus:8853,acirc:226,sup:8835,zeta:950,Iacute:205,Oacute:211,crarr:8629,Nu:925,bdquo:8222,lsquo:8216,apos:39,Beta:914,eacute:233,egrave:232,lceil:8968,Kappa:922,piv:982,Ccedil:199,ldquo:8220,Xi:926,cent:162,uarr:8593,hellip:8230,Aacute:193,ensp:8194,sect:167,Ugrave:217,aelig:230,ordf:170,curren:164,sbquo:8218,macr:175,Phi:934,Eta:919,rho:961,Omicron:927,sup2:178,euro:8364,aring:229,Theta:920,mdash:8212,uuml:252,otilde:245,eta:951,uacute:250,rArr:8658,nsub:8836,agrave:224,notin:8713,ndash:8211,Psi:936,Ocirc:212,sube:8838,szlig:223,micro:181,not:172,sup1:185,middot:183,iota:953,ecirc:234,lsaquo:8249,thinsp:8201,sum:8721,ntilde:241,scaron:353,cap:8745,atilde:227,lang:10216,__replacement:65533,isin:8712,gamma:947,Euml:203,ang:8736,upsilon:965,Ntilde:209,hearts:9829,Alpha:913,Tau:932,spades:9824,dagger:8224,THORN:222,int:8747,lambda:955,Eacute:201,Uuml:220,infin:8734,rlm:8207,Aring:197,ugrave:249,Egrave:200,Acirc:194,rsaquo:8250,ETH:208,oslash:248,alpha:945,Ograve:210,Prime:8243,mu:956,ni:8715,real:8476,bull:8226,beta:946,icirc:238,eth:240,prod:8719,larr:8592,ordm:186,perp:8869,Gamma:915,reg:174,ucirc:251,Pi:928,psi:968,tilde:732,asymp:8776,zwnj:8204,Agrave:192,deg:176,AElig:198,times:215,Delta:916,sim:8764,Otilde:213,Mu:924,uArr:8657,circ:710,theta:952,Rho:929,sup3:179,diams:9830,tau:964,Chi:935,frac14:188,oelig:339,shy:173,or:8744,dArr:8659,phi:966,iuml:239,Lambda:923,rfloor:8971,iexcl:161,cong:8773,ccedil:231,Icirc:206,frac12:189,loz:9674,rarr:8594,cup:8746,radic:8730,frasl:8260,euml:235,OElig:338,hArr:8660,Atilde:195,Upsilon:933,there4:8756,ouml:246,oline:8254,Ecirc:202,yacute:253,auml:228,permil:8240,sigmaf:962,iquest:191,empty:8709,pi:960,Ucirc:219,supe:8839,Igrave:204,yen:165,rang:10217,trade:8482,lfloor:8970,minus:8722,Zeta:918,sub:8834,epsilon:949,yuml:255,Sigma:931,Iuml:207,ocirc:244};s.events.bind("getContent",function(t){return t.replace(/&(?:amp;)?(?!amp|lt|gt|quot)([a-z][a-z0-9]*);/gi,function(t,e){a[e]||(e=e.toLowerCase(),a[e]||(e="__replacement"));var i=a[e];return String.fromCharCode(i)})})}u(s.original).trigger("ready.jwysiwyg",[s.editorDoc,s])},this.innerDocument=function(){var t=this.editor.get(0);if("iframe"===t.nodeName.toLowerCase()){if(t.contentDocument)return t.contentDocument;if(t.contentWindow)return t.contentWindow.document;if(this.isDestroyed)return null;r.error("Unexpected error in innerDocument")}return t},this.insertHtml=function(t){var e,i;return t&&0!==t.length&&(u.browser.msie?(this.ui.focus(),this.editorDoc.execCommand("insertImage",!1,"#jwysiwyg#"),(e=this.getElementByAttributeValue("img","src","#jwysiwyg#"))&&u(e).replaceWith(t)):u.browser.mozilla?1===u(t).length?((i=this.getInternalRange()).deleteContents(),i.insertNode(u(t).get(0))):this.editorDoc.execCommand("insertHTML",!1,t):this.editorDoc.execCommand("insertHTML",!1,t)||(this.editor.focus(),this.editorDoc.execCommand("insertHTML",!1,t)),this.saveContent()),this},this.parseControls=function(){var i=this;return u.each(this.options.controls,function(e,t){u.each(t,function(t){if(-1===u.inArray(t,i.availableControlProperties))throw e+'["'+t+'"]: property "'+t+'" not exists in Wysiwyg.availableControlProperties'})}),this.options.parseControls?this.options.parseControls.call(this):this.options.controls},this.removeFormat=function(){return u.browser.msie&&this.ui.focus(),this.options.removeHeadings&&this.editorDoc.execCommand("formatBlock",!1,"<p>"),this.editorDoc.execCommand("removeFormat",!1,null),this.editorDoc.execCommand("unlink",!1,null),u.wysiwyg.rmFormat&&u.wysiwyg.rmFormat.enabled&&("object"==typeof this.options.plugins.rmFormat.rmMsWordMarkup?u.wysiwyg.rmFormat.run(this,{rules:{msWordMarkup:this.options.plugins.rmFormat.rmMsWordMarkup}}):u.wysiwyg.rmFormat.run(this,{rules:{msWordMarkup:{enabled:!0}}})),this},this.ui.removeHoverClass=function(){u(this).removeClass("wysiwyg-button-hover")},this.resetFunction=function(){this.setContent(this.initialContent)},this.saveContent=function(t){if(!this.viewHTML){if(this.original){var e,i;e="function"==typeof t?t(this.getContent()):this.getContent(),this.options.rmUnwantedBr&&(e=e.replace(/<br\/?>$/,"")),this.options.replaceDivWithP&&((i=u("<div/>").addClass("temp").append(e)).children("div").each(function(){var t,e=u(this),i=e.find("p");if(0===i.length){if(i=u("<p></p>"),0<this.attributes.length)for(t=0;t<this.attributes.length;t+=1)i.attr(this.attributes[t].name,e.attr(this.attributes[t].name));i.append(e.html()),e.replaceWith(i)}}),e=i.html());var o=u.Event("change");o.source=this,u(this.original).val(e).trigger(o),this.options.events&&this.options.events.save&&this.options.events.save.call(this)}return this}},this.setContent=function(t){return this.editorDoc.body.innerHTML=t,this.saveContent(),this},this.triggerControl=function(t,e){var i=e.command||t,o=e.arguments||[];if(e.exec)e.exec.apply(this,e.callbackArguments);else{this.ui.focus(),this.ui.withoutCss();try{this.editorDoc.execCommand(i,!1,o)}catch(t){r.error(t)}}this.options.autoSave&&this.autoSaveFunction()},this.triggerControlCallback=function(t){u(l).trigger("trigger-"+t+".wysiwyg",[this])},this.ui.withoutCss=function(){var e=this.self;if(u.browser.mozilla)try{e.editorDoc.execCommand("styleWithCSS",!1,!1)}catch(t){try{e.editorDoc.execCommand("useCSS",!1,!0)}catch(t){}}return e},this.wrapInitialContent=function(){return this.initialContent}}u.browser===d&&(u.browser=(t=function(t){t=t.toLowerCase();var e=/(chrome)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(t)||[];return{browser:e[1]||"",version:e[2]||"0"}}(navigator.userAgent),e={},t.browser&&(e[t.browser]=!0,e.version=t.version),e.chrome?e.webkit=!0:e.webkit&&(e.safari=!0),e)),u.wysiwyg={messages:{noObject:"Something goes wrong, check object"},addControl:function(t,o,n){return t.each(function(){var t,e=u(this).data("wysiwyg"),i={};if(!e)return this;i[o]=u.extend(!0,{visible:!0,custom:!0},n),u.extend(!0,e.options.controls,i),t=u(e.options.toolbarHtml),e.ui.toolbar.replaceWith(t),e.ui.toolbar=t,e.ui.appendControls()})},clear:function(t){return t.each(function(){var t=u(this).data("wysiwyg");if(!t)return this;t.setContent("")})},resize:function(t){return t.each(function(){var t=u(this).data("wysiwyg");if(!t)return this;t.ui.grow()})},console:r,destroy:function(t){return t.each(function(){var t=u(this).data("wysiwyg");if(!t)return this;t.destroy()})},document:function(t){var e=t.data("wysiwyg");return e?u(e.editorDoc):d},focus:function(t){var e=t.data("wysiwyg");return e?(e.ui.focus(),t):d},getContent:function(t){var e=t.data("wysiwyg");return e?e.getContent():d},getSelection:function(t){var e=t.data("wysiwyg");return e?e.getRangeText():d},init:function(t,i){return t.each(function(){var t,e=u.extend(!0,{},i);"textarea"!==this.nodeName.toLowerCase()||u(this).data("wysiwyg")||((t=new o).init(this,e),u.data(this,"wysiwyg",t),u(t.editorDoc).trigger("afterInit.wysiwyg"))})},insertHtml:function(t,e){return t.each(function(){var t=u(this).data("wysiwyg");if(!t)return this;t.insertHtml(e)})},plugin:{listeners:{},bind:function(n){var s=this;u.each(this.listeners,function(t,e){var i,o;for(i=0;i<e.length;i+=1)o=s.parseName(e[i]),u(n.editorDoc).bind(t+".wysiwyg",{plugin:o},function(t){var e=t.data.plugin.name,i=t.data.plugin.method;u.wysiwyg[e][i].apply(u.wysiwyg[e],[n])})})},exists:function(t){var e;return"string"==typeof t&&(e=this.parseName(t),!(!u.wysiwyg[e.name]||!u.wysiwyg[e.name][e.method]))},listen:function(t,e){var i;return i=this.parseName(e),!(!u.wysiwyg[i.name]||!u.wysiwyg[i.name][i.method])&&(this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e),!0)},parseName:function(t){var e;return"string"==typeof t&&(!((e=t.split(".")).length<2)&&{name:e[0],method:e[1]})},register:function(e){return e.name||r.error("Plugin name missing"),u.each(u.wysiwyg,function(t){t===e.name&&r.error("Plugin with name '"+e.name+"' was already registered")}),u.wysiwyg[e.name]=e,!0}},quirk:{quirks:[],assert:function(t,e){if(!t)throw new Error(e)},register:function(t){this.assert("function"==typeof t.init,"quirk.init must be a function"),this.quirks.push(t)}},removeFormat:function(t){return t.each(function(){var t=u(this).data("wysiwyg");if(!t)return this;t.removeFormat()})},save:function(t){return t.each(function(){var t=u(this).data("wysiwyg");if(!t)return this;t.saveContent()})},selectAll:function(t){var e,i,o=t.data("wysiwyg");if(!o)return this;e=o.editorDoc.body,l.getSelection?o.getInternalSelection().selectAllChildren(e):((i=e.createTextRange()).moveToElementText(e),i.select())},setContent:function(t,e){return t.each(function(){var t=u(this).data("wysiwyg");if(!t)return this;t.setContent(e)})},triggerControl:function(t,e){return t.each(function(){var t=u(this).data("wysiwyg");if(!t)return this;t.controls[e]||r.error("Control '"+e+"' not exists"),t.triggerControl.apply(t,[e,t.controls[e]])})},support:{prop:i},utils:{extraSafeEntities:[["<",">","'",'"'," "],[32]],encodeEntities:function(t){var i,o=this,n=[];return 0===this.extraSafeEntities[1].length&&u.each(this.extraSafeEntities[0],function(t,e){o.extraSafeEntities[1].push(e.charCodeAt(0))}),i=t.split(""),u.each(i,function(t){var e=i[t].charCodeAt(0);u.inArray(e,o.extraSafeEntities[1])&&(e<65||127<e||90<e&&e<97)?n.push("&#"+e+";"):n.push(i[t])}),n.join("")}}},u.wysiwyg.dialog=function(e,t){var i=e&&e.options&&e.options.dialog?e.options.dialog:t.theme?t.theme:"default",o=new u.wysiwyg.dialog.createDialog(i),n=this,s=u(n);return this.options={modal:!0,draggable:!0,title:"Title",content:"Content",width:"auto",height:"auto",zIndex:2e3,open:!1,close:!1},this.isOpen=!1,u.extend(this.options,t),this.object=o,this.open=function(){this.isOpen=!0,o.init.apply(n,[]);var t=o.show.apply(n,[]);s.trigger("afterOpen",[t])},this.show=function(){this.isOpen=!0,s.trigger("beforeShow"),s.trigger("afterShow")},this.hide=function(){this.isOpen=!1,s.trigger("beforeHide");var t=o.hide.apply(n,[]);s.trigger("afterHide",[t])},this.close=function(){this.isOpen=!1;var t=o.hide.apply(n,[]);s.trigger("beforeClose",[t]),o.destroy.apply(n,[]),s.trigger("afterClose",[t]),e.ui.focus()},this.options.open&&s.bind("afterOpen",this.options.open),this.options.close&&s.bind("afterClose",this.options.close),this},u.extend(!0,u.wysiwyg.dialog,{_themes:{},_theme:"",register:function(t,e){u.wysiwyg.dialog._themes[t]=e},deregister:function(t){delete u.wysiwyg.dialog._themes[t]},createDialog:function(t){return new u.wysiwyg.dialog._themes[t]},getDimensions:function(){var t=c.body.scrollWidth,e=c.body.scrollHeight;return u.browser.opera&&(e=Math.max(u(c).height(),u(l).height(),c.documentElement.clientHeight)),[t,e]}}),u(function(){u.ui&&u.wysiwyg.dialog.register("jqueryui",function(){var o=this;this._$dialog=null,this.init=function(){var t=this.options.content;"object"==typeof t&&("function"==typeof t.html?t=t.html():"function"==typeof t.toString&&(t=t.toString())),o._$dialog=u("<div></div>").attr("title",this.options.title).html(t);var e="auto"===this.options.height?300:this.options.height,i="auto"===this.options.width?450:this.options.width;return o._$dialog.dialog({modal:this.options.modal,draggable:this.options.draggable,height:e,width:i}),o._$dialog},this.show=function(){return o._$dialog.dialog("open"),o._$dialog},this.hide=function(){return o._$dialog.dialog("close"),o._$dialog},this.destroy=function(){return o._$dialog.dialog("destroy"),o._$dialog}}),u.wysiwyg.dialog.register("default",function(){var a=this;this._$dialog=null,this.init=function(){var t=this,e=this.options.content;"object"==typeof e&&("function"==typeof e.html?e=e.html():"function"==typeof e.toString&&(e=e.toString())),a._$dialog=u('<div class="wysiwyg-dialog"></div>').css({"z-index":this.options.zIndex});var i=u('<div class="wysiwyg-dialog-topbar"><div class="wysiwyg-dialog-close-wrapper"></div><div class="wysiwyg-dialog-title">'+this.options.title+"</div></div>"),o=u('<a href="#" class="wysiwyg-dialog-close-button">X</a>');o.click(function(){t.close()}),i.find(".wysiwyg-dialog-close-wrapper").prepend(o);var n=u('<div class="wysiwyg-dialog-content">'+e+"</div>");a._$dialog.append(i).append(n);var s="auto"===this.options.height?300:this.options.height,r="auto"===this.options.width?450:this.options.width;return a._$dialog.hide().css({width:r,height:s,left:(u(l).width()-r)/2,top:(u(l).height()-s)/3}),u("body").append(a._$dialog),a._$dialog},this.show=function(){if(this.options.modal){var t=u.wysiwyg.dialog.getDimensions(),e=u('<div class="wysiwyg-dialog-modal-div"></div>').css({width:t[0],height:t[1]});a._$dialog.wrap(e)}if(this.options.draggable){var s=!1;a._$dialog.find("div.wysiwyg-dialog-topbar").bind("mousedown",function(t){t.preventDefault(),u(this).css({cursor:"move"});var e=u(this),i=u(this).parents(".wysiwyg-dialog"),o=t.pageX-parseInt(i.css("left"),10),n=t.pageY-parseInt(i.css("top"),10);s=!0,u(this).css({cursor:"move"}),u(c).bind("mousemove",function(t){t.preventDefault(),s&&i.css({top:t.pageY-n,left:t.pageX-o})}).bind("mouseup",function(t){t.preventDefault(),s=!1,e.css({cursor:"auto"}),u(c).unbind("mousemove").unbind("mouseup")})})}return a._$dialog.show(),a._$dialog},this.hide=function(){return a._$dialog.hide(),a._$dialog},this.destroy=function(){return this.options.modal&&a._$dialog.unwrap(),this.options.draggable&&a._$dialog.find("div.wysiwyg-dialog-topbar").unbind("mousedown"),a._$dialog.remove(),a._$dialog}})}),u.fn.wysiwyg=function(t){var e,i=arguments;return void 0!==u.wysiwyg[t]?(i=Array.prototype.concat.call([i[0]],[this],Array.prototype.slice.call(i,1)),u.wysiwyg[t].apply(u.wysiwyg,Array.prototype.slice.call(i,1))):"object"!=typeof t&&t?u.wysiwyg.plugin.exists(t)?(e=u.wysiwyg.plugin.parseName(t),i=Array.prototype.concat.call([i[0]],[this],Array.prototype.slice.call(i,1)),u.wysiwyg[e.name][e.method].apply(u.wysiwyg[e.name],Array.prototype.slice.call(i,1))):void r.error("Method '"+t+"' does not exist on jQuery.wysiwyg.\nTry to include some extra controls or plugins"):(Array.prototype.unshift.call(i,this),u.wysiwyg.init.apply(u.wysiwyg,i))},u.fn.getWysiwyg=function(){return this.data("wysiwyg")}}(l.jQuery)}(window,document);